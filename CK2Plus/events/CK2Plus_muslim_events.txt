namespace = Plus

#reserved: Plus.1900 to Plus.1950

#######################################
# MUSLIM EVENTS
# Written by Rylock
#######################################

### ANARCHY AT SAMARRA EVENTS (adapted from Heretic Pride mod)

# Caliphate administration seized from a weak caliph
narrative_event = {
	id = Plus.1900
	title = EVTNAME_Plus_1900
	desc = EVTDESC_Plus_1900
	picture = GFX_evt_throne_room_arabic
	
	major = yes
	hide_from = yes
	show_ROOT = yes
	
	only_playable = yes
	prisoner = no
	only_men = yes
	ai = yes
	
	trigger = {
		has_landed_title = d_sunni
		year = 800
		realm_size = 200
		NOT = {
			year = 950
			diplomacy = 10
			martial = 10
			stewardship = 10
			intrigue = 10
			has_global_flag = anarchy_at_samarra
		}
	}

	mean_time_to_happen = {
		months = 12
		modifier = {
			factor = 0.5
			NOT = {
				diplomacy = 5
				martial = 5
				stewardship = 5
				intrigue = 5
			}
		}
	}
	
	option = {
		name = EVTOPTA_Plus_1900
		trigger = { has_landed_title = d_sunni }
		set_global_flag = anarchy_at_samarra
		add_trait = court_anarchy
		hidden_tooltip = {
			crownlaw_title = { add_law_w_cooldown = infighting_0 }
		}
	}
	
	option = {
		name = EVTOPTB_Plus_1900
		trigger = {
			NOT = { has_landed_title = d_sunni }
			religion_group = muslim
		}
		tooltip = {
			ROOT = { add_trait = court_anarchy }
		}
	}
	option = {
		name = EVTOPTC_Plus_1900
		trigger = {
			NOT = { has_landed_title = d_sunni }
			NOT = { religion_group = muslim }
		}
		tooltip = {
			ROOT = { add_trait = court_anarchy }
		}
	}
}
	
# Succeeding caliph remains a prisoner
character_event = {
	id = Plus.1901
	desc = EVTDESC_Plus_1901
	picture = GFX_evt_throne_room_arabic
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { title = d_sunni }
		has_global_flag = anarchy_at_samarra
		NOT = {
			year = 950
			trait = court_anarchy
		}
	}

	option = {
		name = EVTOPTA_Plus_1901
		add_trait = court_anarchy
		hidden_tooltip = {
			FROMFROM = { remove_trait = court_anarchy }
		}
	}
}

# Caliph succeeds at restoring order (fired from decision)
narrative_event = {
	id = Plus.1902
	title = EVTNAME_Plus_1902
	desc = EVTDESC_Plus_1902
	picture = GFX_evt_throne_room_arabic

	major = yes
	hide_from = yes
	show_ROOT = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		OR = {
			ROOT = { higher_tier_than = KING }
			same_realm = ROOT
		}
	}
	
	option = {
		name = EVTOPTA_Plus_1902
		trigger = { has_landed_title = d_sunni }
		clr_global_flag = anarchy_at_samarra
	}
	option = {
		name = EVTOPTB_Plus_1902
		trigger = {
			NOT = { has_landed_title = d_sunni }
			religion_group = muslim
		}
		if = {
			limit = { trait = court_anarchy }
			remove_trait = court_anarchy
		}
	}
	option = {
		name = OK
		trigger = {
			NOT = { has_landed_title = d_sunni }
			NOT = { religion_group = muslim }
		}
	}
}

# A random realm lord will declare independent while the anarchy reigns
character_event = {
	id = Plus.1903

	hide_window = yes
	
	only_playable = yes
	only_men = yes
	
	trigger = {
		has_landed_title = d_sunni
		trait = court_anarchy
		has_global_flag = anarchy_at_samarra
	}
	
	mean_time_to_happen = {
		years = 3
	}

	immediate = {
		random_vassal = {
			limit = {
				war = no
				higher_tier_than = COUNT
				any_demesne_province = {
					any_neighbor_province = {
						owner = { NOT = { same_realm = ROOT } }
					}
				}
				NOT = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
				}
			}
			character_event = { id = Plus.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				higher_tier_than = COUNT
				NOT = {
					dynasty = ROOT
					opinion = { who = ROOT value = 0 }
				}
			}
			character_event = { id = Plus.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				higher_tier_than = COUNT
				any_demesne_province = {
					any_neighbor_province = {
						owner = { NOT = { same_realm = ROOT } }
					}
				}
				NOT = {
					dynasty = ROOT
					opinion = { who = ROOT value = 50 }
				}
			}
			character_event = { id = Plus.1904 }
			break = yes
		}
		random_vassal = {
			limit = {
				war = no
				higher_tier_than = COUNT
				NOT = {
					dynasty = ROOT
					opinion = { who = ROOT value = 50 }
				}
			}
			character_event = { id = Plus.1904 }
			break = yes
		}
	}
}

# Ruler decides whether or not to break free of the caliph
character_event = {
	id = Plus.1904
	desc = EVTDESC_Plus_1904
	picture = GFX_evt_throne_room
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_Plus_1904
		set_defacto_liege = ROOT
		FROM = {
			character_event = { id = Plus.1905 }
		}
		ai_chance = {
			factor = 4
		}
	}
	option = {
		name = EVTOPTB_Plus_1904
		piety = 50
		ai_chance = {
			factor = 1
		}
	}
}

# Caliph hears of the ruler breaking free
character_event = {
	id = Plus.1905
	desc = EVTDESC_Plus_1905
	picture = GFX_evt_throne_room
	
	is_triggered_only = yes
	
	option = {
		name = CURSES
		opinion = {
			who = FROM
			modifier = opinion_rightful_vassal
			years = 20
		}
	}
}

