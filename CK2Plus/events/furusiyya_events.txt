##########################################
#
# Furusiyya Tournament Events
#
# Event ID 88250 - 88499 is reserved
#
##########################################

### INVITATIONS TO THE FURUSIYYA

# Invitations have gone out
character_event = {
	id = 88283
	title = "TOURNAMENTTITLE"
	desc = "EVTDESC88283"
	picture = "GFX_evt_moors"

	is_triggered_only = yes

	option = {
		name = "EVTOPTA88283"
		hidden_tooltip = {
			any_realm_character = {
				limit = {
					is_adult = yes
					prisoner = no
					is_feudal = yes
					is_female = no
					OR = {
						any_spouse = { NOT = { dynasty = 0 } }
						NOT = { dynasty = 0 }
					}
					NOT = {
						has_job_title = job_spiritual
						trait = incapable
						has_character_modifier = do_not_disturb
					}
				}
				character_event = { id = 70000 }
			}
			any_realm_character = {
				limit = {
					is_adult = yes
					prisoner = no
					is_feudal = yes
					is_female = yes
					OR = {
						any_spouse = { NOT = { dynasty = 0 } }
						NOT = { dynasty = 0 }
					}
					NOT = {
						has_job_title = job_spiritual
						trait = incapable
						has_character_modifier = do_not_disturb
					}
				}
				character_event = { id = FemRule.200 }
			}
		}
	}
}

# Start of tournament
character_event = {
	id = 88251
	title = "TOURNAMENTTITLE"
	desc = "EVTDESC88251"
	picture = "GFX_evt_tournament_gallery"

	is_triggered_only = yes

	option = {
		name = "EVTOPTA70001" #I will be taking my place among the fighters!
		trigger = {
			is_female = no
		}
		ai_chance = {
			factor = 70
			modifier = {
				factor = 0
				NOT = { health = 3.1 }
			}
			modifier = {
				factor = 0.5
				NOT = { health = 4.1 }
			}
			modifier = {
				factor = 0.75
				health = 4
				NOT = { health = 5.1 }
			}
			modifier = {
				factor = 2
				martial = 12
			}
			modifier = {
				factor = 2
				martial = 14
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.25
				trait = duelist
			}
		}
		hidden_tooltip = {
			set_character_flag = tournament_begins
			set_character_flag = attending_tournament
		}
	}
	option = {
		name = "EVTOPTC70001" #I look forward to watching the jousts
		ai_chance = {
			factor = 30
			modifier = {
				factor = 1.25
				NOT = { martial = 10 }
			}
			modifier = {
				factor = 1.25
				NOT = { martial = 8 }
			}
			modifier = {
				factor = 1.25
				NOT = { martial = 5 }
			}
			modifier = {
				factor = 0.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = content
			}
		}
		any_vassal = {
			limit = {
				OR = {
					has_minor_title = title_ladys_champion
					has_minor_title = title_champion
				}
				prisoner = no
				NOT = { trait = incapable }
			}
			letter_event = { id = FemRule.201 days = 1 }
		}
		any_courtier = {
			limit = {
				OR = {
					has_minor_title = title_ladys_champion
					has_minor_title = title_champion
				}
				prisoner = no
				NOT = { trait = incapable }
			}
			letter_event = { id = FemRule.201 days = 1 }
		}
		hidden_tooltip = {
			set_character_flag = tournament_begins
			set_character_flag = spectating_tournament
		}
	}
}

# Tournament is over
character_event = {
	id = 88252
	title = TOURNAMENTTITLE
	desc = EVTDESC88252
	picture = GFX_evt_tournament_gallery
	
	only_rulers = yes
	min_age = 16

	trigger = {
		religion_group = muslim
		had_character_flag = {
			flag = tournament_begins
			days = 60
		}
		OR = {
			had_character_flag = {
				flag = tournament_begins
				days = 150
			}
			AND = {
				has_character_flag = winner
				has_character_flag = second_place
				had_character_flag = {
					flag = third_place
					days = 3
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = "EVTOPTA88283"
		custom_tooltip = {
			text = FEUDALFACTIONMOODPLUS
			hidden_tooltip = { change_variable = { which = "faction_mood_feudal" value = 3 } }
		}
		custom_tooltip = {
			text = COURTFACTIONMOODPLUS
			hidden_tooltip = { change_variable = { which = "faction_mood_court" value = 2 } }
		}
		hidden_tooltip = { random_courtier = { limit = { ai = yes } character_event = { id = PlusFaction.306 days = 1 } } }
		remove_character_modifier = do_not_disturb
		remove_character_modifier = holding_epic_tournament
		clr_character_flag = tournament_begins
		clr_character_flag = winner
		clr_character_flag = second_place
		clr_character_flag = third_place
		clr_character_flag = attending_tournament
		clr_character_flag = attending_tournament_event
		clr_character_flag = tournament_third_place
		clr_character_flag = tournament_second_place
		clr_character_flag = tournament_winner
		clr_character_flag = beauty_winner
		clr_character_flag = tournament_romance
		clr_character_flag = spectating_tournament
		clr_character_flag = spectating_tournament_event
		clr_character_flag = no_msg_death
		clr_character_flag = no_msg_maimed
		clr_character_flag = no_msg_wounded
		any_realm_character = {
			limit = {
				NOT = { character = ROOT }
				has_character_flag = attending_tournament
				OR = {
					has_character_flag = tournament_third_place
					has_character_flag = tournament_second_place
					has_character_flag = tournament_winner
				}
			}
			set_character_flag = tournament_has_ended
			opinion = {
				modifier = opinion_tournament_participant
				who = ROOT
				years = 2
			}
		}
		any_realm_character = {
			limit = {
				has_character_flag = attending_tournament
				NOT = { character = ROOT }
				NOT = { has_character_flag = tournament_third_place }
				NOT = { has_character_flag = tournament_second_place }
				NOT = { has_character_flag = tournament_winner }
			}
			hidden_tooltip = {
				random_list = {
					10 = { 
						character_event = { id = 70003 } #Did well
					}
					10 = {
						character_event = { id = 70004 } #Did really well
					}
					10 = {
						character_event = { id = 70005 } #Did poorly
					}
					10 = {
						character_event = { id = 70006 } #Did really poorly
					}
					10 = {
						character_event = { id = 70007 } #Gain Martial
					}
					10 = {
						character_event = { id = 70008 } #Lose Martial
					}
				}
			}
			opinion = {
				modifier = opinion_tournament_participant
				who = ROOT
				years = 2
			}
		}
		hidden_tooltip = {
			any_realm_character = {
				limit = {
					has_character_flag = spectating_tournament
					NOT = { character = ROOT }
				}
				character_event = { id = FemRule.245 }
			}
			any_realm_character = {
				limit = {
					OR = {
						has_character_flag = spectating_tournament
						has_character_flag = attending_tournament
					}
				}
				remove_character_modifier = do_not_disturb
				clr_character_flag = attending_tournament
				clr_character_flag = attending_tournament_event
				clr_character_flag = tournament_third_place
				clr_character_flag = tournament_second_place
				clr_character_flag = tournament_winner
				clr_character_flag = tournament_romance
				clr_character_flag = spectating_tournament
				clr_character_flag = spectating_tournament_event
				clr_character_flag = championing_liege_lady
			}
		}
	}
}

