namespace = Plus

#reserved: Plus.500 to Plus.599

#######################################
# CK2Plus Specific Realm Events
#######################################

### ENGLAND

# If William the Conqueror wins, change k_england to k_englandnorman
character_event = {
	id = Plus.500
	desc = "EVTDESC_Plus_500"
	picture = GFX_evt_throne_room

	is_triggered_only = yes

	option = {
		name = "EVTOPTA_Plus_500"
		k_england = {
			any_direct_de_jure_vassal_title = {
				de_jure_liege = k_englandnorman
			}
		}     
        hidden_tooltip = {
			k_englandnorman = {
				grant_title = PREV
				copy_title_laws = k_england
				copy_title_history = k_england
			}		  
			any_realm_character = {
				limit = {
					has_claim = k_england
				}
				k_englandnorman = { add_pressed_claim = PREV }
				remove_claim = k_england
			}		
			any_playable_ruler = {
			  any_realm_character = {
					limit = {
						has_claim = k_england
					}
					k_englandnorman = { add_pressed_claim = PREV }
					remove_claim = k_england
				}
			}
			k_england = {
				destroy_landed_title = yes
			}
		}
	}
}

# If Harald Hardrada wins, change k_england to k_englandnorwegian
character_event = {
	id = Plus.501
	desc = "EVTDESC_Plus_501"
	picture = GFX_evt_throne_room

	is_triggered_only = yes

	option = {
		name = "EVTOPTA_Plus_500"
		k_england = {
			any_direct_de_jure_vassal_title = {
				de_jure_liege = k_englandnorwegian
			}
		} 
        hidden_tooltip = {
			k_englandnorwegian = {
				grant_title = PREV
				copy_title_laws = k_england
				copy_title_history = k_england
			}		  
			any_realm_character = {
				limit = {
					has_claim = k_england
				}
				k_englandnorwegian = { add_pressed_claim = PREV }
				remove_claim = k_england
			}			
			any_playable_ruler = {
			  any_realm_character = {
					limit = {
						has_claim = k_england
					}
					k_englandnorwegian = { add_pressed_claim = PREV }
					remove_claim = k_england
				}
			}
			k_england = {
				destroy_landed_title = yes
			}
		}
	}
}

### CAROLINGIAN EMPIRE

# Special event for Carolingian Empire to be renamed to HRE
character_event = {
	id = Plus.502
	title = EVTNAME_Plus_502
	desc = EVTDESC_Plus_502

	picture = GFX_evt_council
	border = GFX_event_normal_frame_diplomacy

	only_playable = yes

	trigger = {
		has_landed_title = e_hre
		NOT = { dynasty = 25061 } # Karling dynasty
		NOT = { has_global_flag = hre_renamed }
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = EVTOPTA_Plus_502
		set_global_flag = hre_renamed
		e_hre = {
			set_name=""
			adjective=""
		}
	}
}

### NORMANDY

# Special event for Neustria to be renamed to Normandy
character_event = {
	id = Plus.503
	title = EVTNAME_Plus_503
	desc = EVTDESC_Plus_503

	picture = GFX_evt_council
	border = GFX_event_normal_frame_diplomacy

	only_playable = yes

	trigger = {
		has_landed_title = d_normandy
		OR = {
			culture = norse
			culture = norman
		}
		NOT = { has_global_flag = neustria_renamed }
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = EVTOPTA_Plus_502
		set_global_flag = neustria_renamed
		d_normandy = {
			set_name=""
			adjective=""
		}
	}
}

###ITALY / SICILY

# Christians lament the fall of Sicily and pleads for assistance in the peninsula
narrative_event = {
	id = Plus.504 
	title = EVTNAME_Plus_504
	desc = EVTDESC_Plus_504
	picture = GFX_evt_heretic
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			religion_group = christian
		}
		name = EVTOPTA_Plus_504
	}
	option = {
		trigger = {
			NOT = { religion_group = christian }
		}
		name = EVTOPTA_Plus_504
	}	
}

# The pope has found his champions
character_event = {
	id = Plus.505
	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				NOT = { has_global_flag = neustria_renamed }
			}
			random_list = {
				50 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = italian
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				40 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = norse
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				3 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = croatian
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				2 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = serbian
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				5 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = greek
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_global_flag = neustria_renamed
			}
			random_list = {
				50 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = italian
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				40 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = norman
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				3 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = croatian
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				2 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = serbian
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
				5 = {
					create_character = {	
						random_traits = no
						religion = ROOT
						culture = greek
						dynasty = culture
						female = no
						age = 24
						trait = brilliant_strategist
						trait = holy_warrior
						trait = strong
						trait = zealous
						trait = gregarious
						attributes = {
							martial = 8
							diplomacy = 5
							stewardship = 5
							learning = 5
							intrigue = 5
						}
					}
				}
			}			
		}
		new_character = {
			opinion = {
				who = FROM
				modifier = papal_champion
				months = 360
			}
			religion_head = {
				opinion = {
					who = PREV
					modifier = my_champion
					months = 360
				}			
			}
			if = {
				limit = {
					d_benevento = {
						OR = {
							owner = {
								NOT = { religion_group = christian }
							}
							has_holder = no
						}
					}
				}
				add_pressed_claim = "d_benevento"				
			}
			if = {
				limit = {
					d_apulia = {
						OR = {
							owner = {
								NOT = { religion_group = christian }
							}
							has_holder = no
						}
					}
				}
				add_pressed_claim = "d_apulia"				
			}
			if = {
				limit = {
					d_capua = {
						OR = {
							owner = {
								NOT = { religion_group = christian }
							}
							has_holder = no
						}
					}
				}
				add_pressed_claim = "d_capua"				
			}
			b_tivoli = {
				gain_title = PREV # Temporarily give them a castle so they won't go republic or theocracy if they win against one of those
			}
			set_character_flag = duchy_adventurer
			add_character_modifier = {
				name = italian_reconquest
				hidden = yes
				duration = -1
				inherit = yes
			}
			set_defacto_liege = THIS
			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				culture = THIS
				name = "CLAIMANT_ADVENTURE"
				holder = THIS
			}
			spawn_unit = {
				province = 333
				home = 333
				owner = THIS
				leader = THIS
				match_character = ROOT
				match_mult = 0.2
				match_min = 4000
				match_max = 5000
				attrition = 0.25
				earmark = claimant_adventure
			}
			character_event = { id = Plus.506 } 
		}
	}
}

# The champions head out
character_event = {
	id = Plus.506
	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		ROOT = {
			# Create some decent commander characters
			create_random_soldier = {
				random_traits = yes
				dynasty = culture
				religion = ROOT
				culture = THIS
				female = no
				age = 30
			}
			create_random_soldier = {
				random_traits = yes
				dynasty = culture
				religion = ROOT
				culture = THIS
				female = no
				age = 25
			}
			create_random_soldier = {
				random_traits = yes
				dynasty = culture	
				religion = ROOT
				culture = THIS
				female = no
				age = 33
			}
			create_random_soldier = {
				random_traits = yes
				dynasty = culture
				religion = ROOT
				culture = THIS
				female = no
				age = 29
			}			
			random_claim = {
				holder_scope = {
					reverse_war = {
						target = ROOT
						casus_belli = italian_reconquest
						thirdparty_title = PREV
					}
					if = {
						limit = {
							ai = no # Give the Invaders a boost if targetting players, as players are better at handling the invasion
						}
						ROOT = {
							spawn_unit = {
								province = 333
								home = 333
								owner = THIS
								leader = THIS
								match_character = ROOT
								match_mult = 0.2
								match_min = 2000
								match_max = 3000
								attrition = 0.25
								earmark = claimant_adventure
							}						
						}
					}
				}
			}
		}
		any_playable_ruler = {
			if = {
				limit = { religion_group = christian }
				if = {
					limit = { ROOT = { culture = italian } }
					narrative_event = { id = Plus.508 } 
				}
				if = {
					limit = { ROOT = { culture = norse } }
					narrative_event = { id = Plus.511 } 
				}	
				if = {
					limit = { ROOT = { culture = norman } }
					narrative_event = { id = Plus.512 } 
				}
				if = {
					limit = { ROOT = { culture = croatian } }
					narrative_event = { id = Plus.513 } 
				}
				if = {
					limit = { ROOT = { culture = serbian } }
					narrative_event = { id = Plus.514 } 
				}	
				if = {
					limit = { ROOT = { culture = greek } }
					narrative_event = { id = Plus.515 } 
				}
			}
		}
	}
}


# The pope helps on the offensive!
character_event = { 
	id = Plus.507
	
	is_triggered_only = yes
	hide_window = yes
 
	immediate = {
		religion_head = {
			join_attacker_wars = FROM
		}
	}
}

# The pope helps on the defensive!
character_event = { 
	id = Plus.508
	
	hide_window = yes
	
	trigger = {
		has_global_flag = italian_reconquest_started
		NOT = { 
			has_global_flag = italian_rec_success
			has_global_flag = italian_rec_failure
		}
		war = yes
		is_playable = yes		
		is_feudal = yes
		
		has_character_modifier = italian_reconquest

	}
 
	immediate = {
		religion_head = {
			join_defender_wars = ROOT
		}
	}
}

# The Champions head out, Italian (Narrative event)
narrative_event = { 
	id = Plus.509
	title = EVTTITLE_Plus_515
	desc = EVTDESC_Plus_509
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy	
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_509
	}
	
}

# The King of Sicily is Crowned
narrative_event = { 
	id = Plus.510
	title = EVTTITLE_Plus_510
	desc = EVTDESC_Plus_510
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy	
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_509
	}
}

# The Champions head out, Norse (Narrative event)
narrative_event = { 
	id = Plus.511
	title = EVTTITLE_Plus_515
	desc = EVTDESC_Plus_511
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy	
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_509
	}
	
}

# The Champions head out, Norman (Narrative event)
narrative_event = { 
	id = Plus.512
	title = EVTTITLE_Plus_515
	desc = EVTDESC_Plus_512
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy	
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_509
	}
	
}

# The Champions head out, Croatian (Narrative event)
narrative_event = { 
	id = Plus.513
	title = EVTTITLE_Plus_515
	desc = EVTDESC_Plus_513
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_509
	}
	
}

# The Champions head out, Serbian (Narrative event)
narrative_event = { 
	id = Plus.514
	title = EVTTITLE_Plus_515
	desc = EVTDESC_Plus_514
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy	
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_509
	}
	
}

# The Champions head out, Greek (Narrative event)
narrative_event = { 
	id = Plus.515
	title = EVTTITLE_Plus_515
	desc = EVTDESC_Plus_515
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_Plus_509
	}
	
}

# The King of Sicily is Crowned (Recipient)
narrative_event = { 
	id = Plus.516
	title = EVTTITLE_Plus_516
	desc = EVTDESC_Plus_516
	picture = GFX_evt_pope
	border = GFX_event_narrative_frame_diplomacy
	sound = church_bells	
	
	is_triggered_only = yes
	
	immediate = {
		k_sicily = {
			gain_title = ROOT
		}
		prestige = 500
	}
	
	option = {
		name = EVTOPTA_Plus_516
	}
}

# The Invasion Fails
narrative_event = { 
	id = Plus.517
	title = EVTTITLE_Plus_517
	desc = EVTDESC_Plus_517
	picture = GFX_evt_rome_falls
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			religion_group = christian
		}
		name = EVTOPTA_Plus_503
	}
	option = {
		trigger = {
			NOT = { religion_group = christian }
		}
		name = EVTOPTA_Plus_503
	}
	
}

# Maintenance Check for Failed Invasion (landless or vassal invaders)
character_event = { 
	id = Plus.518
	
	hide_window = yes
	
	trigger = {
		has_global_flag = italian_reconquest_started
		has_global_flag = first_war_success
		NOT = { 
			has_global_flag = italian_rec_success
			has_global_flag = italian_rec_failure
		}
		war = no	
		OR = {
			independent = no
			is_ruler = no
		}		
		has_character_modifier = italian_reconquest
	}
	
	mean_time_to_happen = {
		days = 1	
	}
	
	immediate = {
		remove_character_modifier = italian_reconquest
		religion_head = {
			remove_opinion = {
				who = ROOT
				modifier = my_champion
			}
		}
		set_global_flag = italian_rec_failure
		any_playable_ruler = { narrative_event = { id = Plus.517 } }
	}
}

# Maintenance Check, Start the invasion
character_event = { 
	id = Plus.519
	
	hide_window = yes
	
	trigger = {
		has_global_flag = italian_reconquest_planning
		NOT = { 
			has_global_flag = italian_reconquest_started
		}
		has_landed_title = k_papal_state
		has_character_modifier = italian_reconquest_pope
		
		NOT = {
			c_benevento = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_foggia = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_capua = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_napoli = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_apulia = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_bari = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_lecce = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_salerno = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_taranto = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_amalfi = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_consenza = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_reggio = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_palermo = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_messina = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_siracusa = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_agrigento = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_trapani = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}
			c_malta = {
				holder_scope = {
					top_liege = {
						has_character_modifier = holy_truce_timer
					}
				}
			}			
		}
	}
	
	mean_time_to_happen = {
		years = 2
	}
	
	immediate = {
		remove_character_modifier = italian_reconquest_pope
		set_global_flag = italian_reconquest_started
		character_event = { id = Plus.504 }
	}
}