# Faction tags need to start with 'faction_'

# Supported types:
# liege_titles, liege_titles_w_claimant, character

# The succession law factions have hard coded elements to ensure that the correct heir is shown in Plot and 
# Faction interfaces and that AI faction members vote for laws in accordance with the faction goal.
# The valid tags correspond to the law name: faction_succ_seniority, faction_succ_primogeniture, etc.

###############
# FACTIONS
###############

# Court faction: desires more power for vassals
faction_court = {
	type = character
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			NOT = {
				character = ROOT
				has_character_flag = faction_court_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		OR = {
			ai = no
			NOT = { has_character_flag = faction_reboot }
			had_character_flag = { flag = faction_reboot days = 7 }
		}
		NOT = {
			any_faction_backer = {
				faction = faction_court
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOT = {
			leads_faction = faction_prosperity
			leads_faction = faction_glory
			leads_faction = faction_tradition
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { trait = in_hiding }
			NOT = { has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction } }
			OR = {
				ai = no
				NOT = { has_character_flag = faction_reboot }
				had_character_flag = { flag = faction_reboot days = 7 }
			}
		}
	}
	
	# AI creation weight (ROOT = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_court_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 10
			real_tier = king
			liege = { real_tier = emperor }
		}
		modifier = {
			factor = 10
			real_tier = duke
			liege = { real_tier = king }
		}
		modifier = {
			factor = 0
			ROOT = {
				liege = {
					current_heir = { character = ROOT }
				}
			}
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_court_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Prosperity faction: desires wealth and a healthy economy
faction_prosperity = {
	type = character
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			NOT = {
				character = ROOT
				has_character_flag = faction_properity_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		OR = {
			ai = no
			NOT = { has_character_flag = faction_reboot }
			had_character_flag = { flag = faction_reboot days = 7 }
		}
		NOT = {
			any_faction_backer = {
				faction = faction_prosperity
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOT = {
			leads_faction = faction_court
			leads_faction = faction_glory
			leads_faction = faction_tradition
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { trait = in_hiding }
			NOT = { has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction } }
			OR = {
				ai = no
				NOT = { has_character_flag = faction_reboot }
				had_character_flag = { flag = faction_reboot days = 7 }
			}
		}
	}
	
	# AI creation weight (ROOT = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_prosperity_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 10
			real_tier = king
			liege = { real_tier = emperor }
		}
		modifier = {
			factor = 10
			real_tier = duke
			liege = { real_tier = king }
		}
		modifier = {
			factor = 0
			ROOT = {
				liege = {
					current_heir = { character = ROOT }
				}
			}
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_prosperity_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Glory faction: desires prestige and the spoils of war
faction_glory = {
	type = character
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			NOT = {
				character = ROOT
				has_character_flag = faction_glory_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		OR = {
			ai = no
			NOT = { has_character_flag = faction_reboot }
			had_character_flag = { flag = faction_reboot days = 7 }
		}
		NOT = {
			any_faction_backer = {
				faction = faction_glory
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOT = {
			leads_faction = faction_court
			leads_faction = faction_prosperity
			leads_faction = faction_tradition
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { trait = in_hiding }
			NOT = { has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction } }
			OR = {
				ai = no
				NOT = { has_character_flag = faction_reboot }
				had_character_flag = { flag = faction_reboot days = 7 }
			}
		}
	}
	
	# AI creation weight (ROOT = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_glory_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 10
			real_tier = king
			liege = { real_tier = emperor }
		}
		modifier = {
			factor = 10
			real_tier = duke
			liege = { real_tier = king }
		}
		modifier = {
			factor = 0
			ROOT = {
				liege = {
					current_heir = { character = ROOT }
				}
			}
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_glory_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Tradition faction: desires piety and support for religion
faction_tradition = {
	type = character
	
	# Plotter scope
	potential = {
		is_ruler = yes
		is_landed = yes
		independent = no
		prisoner = no
		is_adult = yes
		NOT = {
			trait = incapable
			trait = excommunicated
		}
		liege = {
			religion = ROOT
			NOT = {
				character = ROOT
				has_character_flag = faction_tradition_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
				any_demesne_title = { temporary = yes }
			}
		}
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = { flag = former_faction_leader days = 7 }
		}
		OR = {
			ai = no
			NOT = { has_character_flag = faction_reboot }
			had_character_flag = { flag = faction_reboot days = 7 }
		}
		NOT = {
			any_faction_backer = {
				faction = faction_tradition
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		NOT = {
			leads_faction = faction_court
			leads_faction = faction_prosperity
			leads_faction = faction_glory
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			prisoner = no
			liege = { religion = ROOT }
			NOT = { trait = incapable }
			NOT = { trait = excommunicated }
			NOT = { trait = in_hiding }
			NOT = { has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction } }
			OR = {
				ai = no
				NOT = { has_character_flag = faction_reboot }
				had_character_flag = { flag = faction_reboot days = 7 }
			}
		}
	}
	
	# AI creation weight (ROOT = faction creator)
	chance = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_tradition_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			ROOT = { trait = cynical }
		}
		modifier = {
			factor = 10
			real_tier = king
			liege = { real_tier = emperor }
		}
		modifier = {
			factor = 10
			real_tier = duke
			liege = { real_tier = king }
		}
		modifier = {
			factor = 0
			ROOT = {
				liege = {
					current_heir = { character = ROOT }
				}
			}
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			ROOT = {
				NOT = { has_character_flag = faction_tradition_supporter }
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			ROOT = { trait = cynical }
		}
	}
	
	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}	

# Separatist faction, forms purely for the purpose of waging an independence war
faction_separatist = {
	type = character

	# Plotter scope
	potential = {
		prisoner = no
		is_ruler = yes
		independent = no
		is_landed = yes
		is_adult = yes
		
		NOT = { trait = incapable }
		
		higher_tier_than = BARON
		OR = {
			ai = no
			is_feudal = yes
			is_tribal = yes
			higher_tier_than = COUNT
		}
		
		liege = {
			independent = yes
			NOT = { has_character_flag = faction_separatist_war }
			NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction } }
			# Mongols and Aztecs do not have independence revolt problems before 1350
			OR = {
				year = 1350
				primary_title = { is_tribal_type_title = no }
				NOT = { culture = ROOT }
				NOT = { religion = ROOT }
				NOT = {
					culture = nahuatl
					culture = mongol
				}
			}
			
			# Not allowed to start factions like this if our capital borders the liege's capital
			NOT = {
				capital_scope = {
					any_neighbor_province = {
						ROOT = {
							capital_scope = { province = PREVPREV }
						}
					}
				}
			}
			
			NOT = {
				trait = rebel
				any_demesne_title = { temporary = yes }
			}
		}
	}

	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			NOT = { has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction } }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 50
		modifier = {
			factor = 0
			is_patrician = yes
			is_merchant_republic = no
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			preparing_invasion = yes
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = { character = ROOT }
			}
		}
		modifier = {
			factor = 0.25
			liege = {
				OR = {
					dynasty = ROOT
					is_close_relative = ROOT
					is_allied_with = ROOT
				}
			}
		}
		modifier = {
			factor = 0.2
			pacifist = yes
		}
		modifier = {
			factor = 1.5
			primary_title = {
				is_vice_royalty = yes
			}
		}
		modifier = {
			factor = 0.1
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
			liege = {
				capital_scope = {
					ROOT = {
						capital_scope = {
							NOT = {
								distance = { 
									where = PREVPREV
									value = 200
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			liege = {
				religion = ROOT
				culture = ROOT
			}
		}
		modifier = {
			factor = 0.5
			liege = {
				OR = {
					NOT = { religion = ROOT }
					NOT = { culture = ROOT }
				}
				OR = {
					religion = ROOT
					culture = ROOT
				}
			}
		}
		modifier = {
			factor = 1.5
			liege = {
				capital_scope = {
					ROOT = {
						capital_scope = {
							distance = { 
								where = PREVPREV
								value = 500
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 2.0
			liege = {
				capital_scope = {
					ROOT = {
						capital_scope = {
							distance = { 
								where = PREVPREV
								value = 750
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 2.0
			liege = {
				NOT = { religion_group = ROOT }
			}
		}
		modifier = {
			factor = 0.5
			liege = {
				NOT = { religion = ROOT }
				religion_group = ROOT
			}
		}
		# Try to exclude people who should rather support a claimant
		modifier = {
			factor = 0
			lower_tier_than = KING
			liege = {
				OR = {
					NOT = { culture = ROOT }
					NOT = { religion = ROOT }
				}
				any_demesne_title = {
					OR = {
						is_primary_holder_title = yes
						higher_tier_than = DUKE
					}
					ROOT = {
						primary_title = { de_jure_liege_or_above = PREVPREV }
					}
					any_claimant = {
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			opinion = { who = LIEGE value = 20 }
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 40 }
		}
		modifier = {
			factor = 0
			lower_tier_than = KING
			opinion = { who = LIEGE value = 0 }
			OR = {
				liege = { de_jure_vassal_or_below = ROOT }
				capital_scope = { has_province_flag = contingent_territory }
			}
		}
		modifier = {
			factor = 1.5
			NOT = { opinion = { who = LIEGE value = -50 } } 
		}
		modifier = {
			factor = 2.0
			NOT = { opinion = { who = LIEGE value = -75 } } 
		}
		modifier = {
			factor = 0.025
			trait = content
		}
		modifier = {
			factor = 0.025
			trait = imbecile
		}
		modifier = {
			factor = 0.025
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0.1
			trait = slow
		}
		modifier = {
			factor = 0.5
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.75
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = envious
		}
		modifier = {
			factor = 2.0
			trait = greedy
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 2.0
			trait = deceitful
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}		
		# Not at all if liege is same culture/religion, is de jure liege, and connected to capital
		modifier = {
			factor = 0
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
			liege = {
				religion = ROOT
				culture = ROOT
				de_jure_vassal_or_below = ROOT
			}
			capital_scope = { has_province_flag = contingent_territory }
		}
		# Lower if liege is both de jure liege and connected to capital
		modifier = {
			factor = 0.25
			liege = { de_jure_vassal_or_below = ROOT }
			capital_scope = { has_province_flag = contingent_territory }
		}
		# Lower if liege is either de jure liege or connected to capital
		modifier = {
			factor = 0.5
			OR = {
				liege = { NOT = { de_jure_vassal_or_below = ROOT } }
				capital_scope = { NOT = { has_province_flag = contingent_territory } }
			}
			OR = {
				liege = { de_jure_vassal_or_below = ROOT }
				capital_scope = { has_province_flag = contingent_territory }
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 50
		modifier = {
			factor = 0
			is_patrician = yes
			is_merchant_republic = no
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			preparing_invasion = yes
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = { character = ROOT }
			}
		}
		modifier = {
			factor = 0.25
			liege = {
				OR = {
					dynasty = ROOT
					is_close_relative = ROOT
					is_allied_with = ROOT
				}
			}
		}
		modifier = {
			factor = 0.2
			pacifist = yes
		}
		modifier = {
			factor = 1.5
			primary_title = {
				is_vice_royalty = yes
			}
		}
		modifier = {
			factor = 0.1
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
			liege = {
				capital_scope = {
					ROOT = {
						capital_scope = {
							NOT = {
								distance = { 
									where = PREVPREV
									value = 200
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			liege = {
				religion = ROOT
				culture = ROOT
			}
		}
		modifier = {
			factor = 0.5
			liege = {
				OR = {
					NOT = { religion = ROOT }
					NOT = { culture = ROOT }
				}
				OR = {
					religion = ROOT
					culture = ROOT
				}
			}
		}
		modifier = {
			factor = 1.5
			liege = {
				capital_scope = {
					ROOT = {
						capital_scope = {
							distance = { 
								where = PREVPREV
								value = 500
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 2.0
			liege = {
				capital_scope = {
					ROOT = {
						capital_scope = {
							distance = { 
								where = PREVPREV
								value = 750
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 2.0
			liege = {
				NOT = { religion_group = ROOT }
			}
		}
		modifier = {
			factor = 0.5
			liege = {
				NOT = { religion = ROOT }
				religion_group = ROOT
			}
		}
		# Try to exclude people who should rather support a claimant
		modifier = {
			factor = 0
			lower_tier_than = KING
			liege = {
				OR = {
					NOT = { culture = ROOT }
					NOT = { religion = ROOT }
				}
				any_demesne_title = {
					OR = {
						is_primary_holder_title = yes
						higher_tier_than = DUKE
					}
					ROOT = {
						primary_title = { de_jure_liege_or_above = PREVPREV }
					}
					any_claimant = {
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			opinion = { who = LIEGE value = 20 }
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 40 }
		}
		modifier = {
			factor = 0
			lower_tier_than = KING
			opinion = { who = LIEGE value = 0 }
			OR = {
				liege = { de_jure_vassal_or_below = ROOT }
				capital_scope = { has_province_flag = contingent_territory }
			}
		}
		modifier = {
			factor = 1.5
			NOT = { opinion = { who = LIEGE value = -50 } } 
		}
		modifier = {
			factor = 2.0
			NOT = { opinion = { who = LIEGE value = -75 } } 
		}
		modifier = {
			factor = 0.025
			trait = content
		}
		modifier = {
			factor = 0.025
			trait = imbecile
		}
		modifier = {
			factor = 0.025
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0.1
			trait = slow
		}
		modifier = {
			factor = 0.5
			trait = kind
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.75
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = envious
		}
		modifier = {
			factor = 2.0
			trait = greedy
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 2.0
			trait = deceitful
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}		
		# Not at all if liege is same culture/religion, is de jure liege, and connected to capital
		modifier = {
			factor = 0
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
			liege = {
				religion = ROOT
				culture = ROOT
				de_jure_vassal_or_below = ROOT
			}
			capital_scope = { has_province_flag = contingent_territory }
		}
		# Lower if liege is both de jure liege and connected to capital
		modifier = {
			factor = 0.25
			liege = { de_jure_vassal_or_below = ROOT }
			capital_scope = { has_province_flag = contingent_territory }
		}
		# Lower if liege is either de jure liege or connected to capital
		modifier = {
			factor = 0.5
			OR = {
				liege = { NOT = { de_jure_vassal_or_below = ROOT } }
				capital_scope = { NOT = { has_province_flag = contingent_territory } }
			}
			OR = {
				liege = { de_jure_vassal_or_below = ROOT }
				capital_scope = { has_province_flag = contingent_territory }
			}
		}
	}

	success = {
		independent = yes
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

# Faction supports claimant to the throne
faction_pretender = {
	type = liege_titles_w_claimant # 'new_character' is a Claimant, or, if the title is Elective, anyone eligible for election
	exclusive = yes # Can only lead or be in one faction of this type

	# Plotter scope
	potential = {
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		is_landed = yes
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			OR = {
				is_feudal = yes
				is_tribal = yes
			}
			OR = {
				# Hordes should have less problems with this type of faction until ca 1350
				year = 1350
				primary_title = { is_tribal = no }
				NOT = { culture = ROOT }
				NOT = { religion = ROOT }
			}
			NOT = {
				any_demesne_title = {
					temporary = yes
				}
			}
		}
	}

	# Target scope
	allow = {
		is_primary_holder_title_tier = yes
		OR = {
			is_primary_holder_title = yes
			FROM = { 
				primary_title = {
					OR = {
						dejure_liege_title = { title = PREVPREVPREV }
						kingdom = { title = PREVPREVPREV }
						empire = { title = PREVPREVPREV }
					}
				}
			}
		}
		new_character = { prisoner = no }
		NOT = {
			new_character = {
				ROOT = {
					holder_scope = {
						character = PREVPREV
					}
				}
			}
		}
		NOT = {
			AND = {
				NOT = { has_law = succ_feudal_elective }
				current_heir = {
					new_character = {
						character = PREV
					}
				}
			}
		}
		new_character = {
			OR = {
				is_ruler = no
				is_feudal = yes
				is_tribal = yes
			}
		}
		OR = {
			new_character = { is_female = no }
			AND = {
				NOT = { new_character = { religion_group = muslim } }
				NOT = { has_law = agnatic_succession }
			}
		}
		OR = {
			NOT = { has_law = succ_feudal_elective }
			new_character = { is_ruler = no }
			new_character = {
				primary_title = {
					OR = {
						empire = { title = PREVPREVPREV }
						kingdom = { title = PREVPREVPREV }
						dejure_liege_title = { title = PREVPREVPREV }
					}
				}
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 1
		modifier = {
			factor = 0.2
			always = yes
		}
		modifier = {
			factor = 0.1
			NOT = { is_primary_holder_title = yes }
		}
		modifier = {
			factor = 0
			FROM = { controls_religion = yes }
		}
		modifier = {
			factor = 0
			FROM = { 
				OR = {
					trait = incapable
					is_adult = no
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { 
				liege = {
					current_heir = {
						character = FROM
					}
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { FROM = { liege = { culture = FROM } } }
				NOT = { FROM = { liege = { religion_group = FROM } } }
			}
			FROM = { opinion = { who = liege value = 25 } }
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { FROM = { liege = { culture = FROM } } }
				NOT = { FROM = { liege = { religion_group = FROM } } }
			}
			FROM = { 
				opinion = { who = liege value = 0 } 
				NOT = {
					trait = proud
					trait = ambitious
					trait = envious
					trait = brave
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			FROM = { liege = { culture = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = { 
				NOT = {
					OR = {
						leads_faction = faction_court
						leads_faction = faction_prosperity
						leads_faction = faction_glory
						leads_faction = faction_tradition
						AND = {
							in_faction = faction_court
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_court
							}
						}
						AND = {
							in_faction = faction_prosperity
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_prosperity
							}
						}
						AND = {
							in_faction = faction_glory
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_glory
							}
						}
						AND = {
							in_faction = faction_tradition
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_tradition
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			FROM = { liege = { culture = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = { 
				OR = {
					AND = {
						leads_faction = faction_court
						liege = {
							NOT = {
								has_character_flag = faction_court_unhappy
								has_character_flag = faction_court_angry
							}
						}
					}
					AND = {
						leads_faction = faction_prosperity
						liege = {
							NOT = {
								has_character_flag = faction_prosperity_unhappy
								has_character_flag = faction_prosperity_angry
							}
						}
					}
					AND = {
						leads_faction = faction_glory
						liege = {
							NOT = {
								has_character_flag = faction_glory_unhappy
								has_character_flag = faction_glory_angry
							}
						}
					}
					AND = {
						leads_faction = faction_tradition
						liege = {
							NOT = {
								has_character_flag = faction_tradition_unhappy
								has_character_flag = faction_tradition_angry
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			NOT = { new_character = { character = FROM } }
			FROM = { liege = { culture = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = { 
				OR = {
					AND = {
						leads_faction = faction_court
						liege = {
							has_character_flag = faction_court_unhappy
						}
					}
					AND = {
						leads_faction = faction_prosperity
						liege = {
							has_character_flag = faction_prosperity_unhappy
						}
					}
					AND = {
						leads_faction = faction_glory
						liege = {
							has_character_flag = faction_glory_unhappy
						}
					}
					AND = {
						leads_faction = faction_tradition
						liege = {
							has_character_flag = faction_tradition_unhappy
						}
					}
				}
			}
		}
		modifier = {
			factor = 3
			holder_scope = {
				OR = {
					prisoner = yes
					is_adult = no
					trait = incapable
				}
			}
		}
		modifier = {
			factor = 2
			new_character = { has_character_flag = justified_claimant }
		}
		modifier = {
			factor = 10
			new_character = { character = FROM }
		}
		modifier = {
			factor = 3
			FROM = {
				leads_faction = faction_court
			}
		}
		modifier = {
			factor = 2
			FROM = { 
				leads_faction = faction_tradition
				liege = { trait = excommunicated }
			}
		}
		modifier = {
			factor = 0.5
			FROM = { 
				leads_faction = faction_tradition
				liege = { NOT = { trait = excommunicated } }
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					trait = content
					trait = humble
					trait = slothful
					trait = craven
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			new_character = {
				NOT = { culture = FROM }
			}
		}
		modifier = {
			factor = 0.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				NOT = { culture = FROM }
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			new_character = {
				NOT = { religion = FROM }
			}
		}
		modifier = {
			factor = 0.1
			NOT = { new_character = { character = FROM } }
			NOT = {
				new_character = {
					FROM = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 10 # I don't like the pretender enough
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 25
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 50
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 75
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 100
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						opinion = {
							who = PREV
							value = 50
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						opinion = {
							who = PREV
							value = 25
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = 0
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = -25
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = -50
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = -75
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			new_character = { is_female = yes }
			NOT = { has_law = true_cognatic_succession }
		}
		modifier = {
			factor = 0
			new_character = {
				FROM = {
					liege = {
						OR = {
							is_father = PREVPREV
							is_mother = PREVPREV
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.1
			holder_scope = {
				dynasty = FROM
				religion = FROM
				culture = FROM
			}
			new_character = {
				NOT = { dynasty = FROM }
			}
		}
		modifier = {
			factor = 0
			new_character = {
				OR = {
					trait = blinded
					trait = eunuch
					trait = incapable
					trait = imbecile
					trait = inbred
					AND = {
						is_female = yes
						age = 40
					}
				}
			}
		}
		modifier = {
			factor = 3.0
			new_character = { character = FROM }
			FROM = { trait = ambitious }
		}
		modifier = {
			factor = 1.5
			new_character = { is_close_relative = FROM }
		}
		modifier = {
			factor = 0.75
			NOT = { new_character = { is_close_relative = FROM } }
		}
		modifier = {
			factor = 0
			new_character = { character = FROM }
			FROM = { trait = content }
		}
		modifier = {
			factor = 0
			new_character = { character = FROM }
			FROM = { liege = { culture = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = {
				opinion = {
					who = liege
					value = -50
				}
				NOT = {
					OR = {
						AND = {
							leads_faction = faction_court
							liege = {
								NOT = {
									has_character_flag = faction_court_unhappy
									has_character_flag = faction_court_angry
								}
							}
						}
						AND = {
							leads_faction = faction_prosperity
							liege = {
								NOT = {
									has_character_flag = faction_prosperity_unhappy
									has_character_flag = faction_prosperity_angry
								}
							}
						}
						AND = {
							leads_faction = faction_glory
							liege = {
								NOT = {
									has_character_flag = faction_glory_unhappy
									has_character_flag = faction_glory_angry
								}
							}
						}
						AND = {
							leads_faction = faction_tradition
							liege = {
								NOT = {
									has_character_flag = faction_tradition_unhappy
									has_character_flag = faction_tradition_angry
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			new_character = { character = FROM }
			FROM = {
				opinion = {
					who = liege
					value = -25
				}
				NOT = {
					OR = {
						AND = {
							leads_faction = faction_court
							liege = {
								NOT = {
									has_character_flag = faction_court_angry
								}
							}
						}
						AND = {
							leads_faction = faction_prosperity
							liege = {
								NOT = {
									has_character_flag = faction_prosperity_angry
								}
							}
						}
						AND = {
							leads_faction = faction_glory
							liege = {
								NOT = {
									has_character_flag = faction_glory_angry
								}
							}
						}
						AND = {
							leads_faction = faction_tradition
							liege = {
								NOT = {
									has_character_flag = faction_tradition_angry
								}
							}
						}
					}
				}
			}
		}
		# If there is an antiking faction, prioritize that
		modifier = {
			factor = 0
			FROM = {
				has_character_flag = opposes_the_antipope
				OR = {
					religion = catholic
					religion = fraticelli
				}
				liege = {
					religion = FROM
					rightful_religious_head_scope = {
						vassal_of = PREV
						OR = {
							has_claim = k_papal_state
							has_claim = d_fraticelli
						}
					}
					any_vassal = {
						leads_faction = faction_antiking
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				has_opinion_modifier = {
					who = LIEGE
					modifier = opinion_coerced_into_leaving_faction
				}
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 1
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				trait = incapable
				is_adult = no
			}
		}
		modifier = {
			factor = 0
			ROOT = { 
				liege = {
					current_heir = {
						character = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROMFROM = { is_conquered = yes }
			FROM = { 
				supported_claimant = {
					NOT = { culture = ROOT }
				} 
			}
		}
		modifier = {
			factor = 0
			prisoner = yes
		}
		#different culture group: uses another calc
		modifier = {
			factor = 100
			OR = {
				NOT = { liege = { culture = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			FROM = { 
				supported_claimant = {
					culture = ROOT
					religion = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { liege = { culture = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			opinion = { who = liege value = 25 }
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { liege = { culture = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			ROOT = { 
				opinion = { who = liege value = 0 } 
				NOT = {
					trait = proud
					trait = ambitious
					trait = envious
					trait = brave
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			liege = { culture = ROOT }
			liege = { religion_group = ROOT }
			ROOT = { 
				NOT = {
					OR = {
						leads_faction = faction_court
						leads_faction = faction_prosperity
						leads_faction = faction_glory
						leads_faction = faction_tradition
						AND = {
							in_faction = faction_court
							FROM = {
								OR = {
									leads_faction = faction_court
									any_faction_backer = {
										faction = faction_pretender
										leads_faction = faction_court
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_court_angry }
								}
							}
						}
						AND = {
							in_faction = faction_prosperity
							FROM = {
								OR = {
									leads_faction = faction_prosperity
									any_faction_backer = {
										faction = faction_pretender
										leads_faction = faction_prosperity
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_prosperity_angry }
								}
							}
						}
						AND = {
							in_faction = faction_glory
							FROM = {
								OR = {
									leads_faction = faction_glory
									any_faction_backer = {
										faction = faction_pretender
										leads_faction = faction_glory
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_glory_angry }
								}
							}
						}
						AND = {
							in_faction = faction_tradition
							FROM = {
								OR = {
									leads_faction = faction_tradition
									any_faction_backer = {
										faction = faction_pretender
										leads_faction = faction_tradition
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_tradition_angry }
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 100
			OR = {
				FROM = { supported_claimant = { character = ROOT } }
				AND = {
					in_faction = faction_court
					FROM = {
						OR = {
							leads_faction = faction_court
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_court
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_court_angry }
						}
					}
				}
				AND = {
					in_faction = faction_prosperity
					FROM = {
						OR = {
							leads_faction = faction_prosperity
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_prosperity
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_prosperity_angry }
						}
					}
				}
				AND = {
					in_faction = faction_glory
					FROM = {
						OR = {
							leads_faction = faction_glory
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_glory
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_glory_angry }
						}
					}
				}
				AND = {
					in_faction = faction_tradition
					FROM = {
						OR = {
							leads_faction = faction_tradition
							any_faction_backer = {
								faction = faction_pretender
								leads_faction = faction_tradition
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_tradition_angry }
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			liege = { culture = ROOT }
			liege = { religion_group = ROOT }
			OR = {
				AND = {
					leads_faction = faction_court
					liege = {
						NOT = {
							has_character_flag = faction_court_unhappy
							has_character_flag = faction_court_angry
						}
					}
				}
				AND = {
					leads_faction = faction_prosperity
					liege = {
						NOT = {
							has_character_flag = faction_prosperity_unhappy
							has_character_flag = faction_prosperity_angry
						}
					}
				}
				AND = {
					leads_faction = faction_glory
					liege = {
						NOT = {
							has_character_flag = faction_glory_unhappy
							has_character_flag = faction_glory_angry
						}
					}
				}
				AND = {
					leads_faction = faction_tradition
					liege = {
						NOT = {
							has_character_flag = faction_tradition_unhappy
							has_character_flag = faction_tradition_angry
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			liege = { culture = ROOT }
			liege = { religion_group = ROOT }
			OR = {
				AND = {
					leads_faction = faction_court
					liege = {
						has_character_flag = faction_court_unhappy
					}
				}
				AND = {
					leads_faction = faction_prosperity
					liege = {
						has_character_flag = faction_prosperity_unhappy
					}
				}
				AND = {
					leads_faction = faction_glory
					liege = {
						has_character_flag = faction_glory_unhappy
					}
				}
				AND = {
					leads_faction = faction_tradition
					liege = {
						has_character_flag = faction_tradition_unhappy
					}
				}
			}
		}
		modifier = {
			factor = 3
			FROMFROM = { holder_scope = { regent = { is_alive = yes } } }
		}
		modifier = {
			factor = 3
			FROM = {
				leads_faction = faction_court
			}
		}
		modifier = {
			factor = 2
			FROM = {
				leads_faction = faction_tradition
				liege = { trait = excommunicated }
			}
		}
		modifier = {
			factor = 0.5
			FROM = {
				leads_faction = faction_tradition
				liege = { NOT = { trait = excommunicated } }
			}
		}
		modifier = {
			factor = 2
			FROM = { supported_claimant = { has_character_flag = justified_claimant } }
		}
		modifier = {
			factor = 1.5
			FROM = { supported_claimant = { is_close_relative = ROOT } }
		}
		modifier = {
			factor = 0.75
			FROM = { NOT = { supported_claimant = { is_close_relative = ROOT } } }
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					NOT = { culture = ROOT }
				}
			}
		}
		modifier = {
			factor = 0.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					NOT = { culture = ROOT }
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					NOT = { religion = ROOT }
				}
			}
		}
		modifier = {
			factor = 0.1
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			NOT = {
				FROM = {
					supported_claimant = {
						ROOT = {
							opinion_diff = {
								first = PREV
								second = LIEGE
								value = 10
								as_if_liege = yes
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 25
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 50
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 75
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 100
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			FROM = { supported_claimant = { is_female = yes } }
			NOT = { FROMFROM = { has_law = true_cognatic_succession } }
		}
		modifier = {
			factor = 2.0
			FROMFROM = {
				new_character = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 40
							as_if_liege = yes
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 2.0
			FROMFROM = {
				new_character = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 60
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.01
			trait = content
			FROMFROM = {
				OR = {
					is_conquered = no
					conquest_culture = ROOT
				}
			}
		}	
		modifier = {
			factor = 2.0
			liege = {
				dynasty_realm_power = 0.25
			}
			FROMFROM = {
				new_character = {
					ROOT = {
						liege = { 
							NOT = { dynasty = PREVPREV }
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 2.0
			liege = {
				dynasty_realm_power = 0.4
			}
			FROMFROM = {
				new_character = {
					ROOT = {
						liege = { 
							NOT = { dynasty = PREVPREV }
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 0.01
			trait = imbecile
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0.1
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = content
		}
		modifier = {
			factor = 0.5
			trait = humble
		}
		modifier = {
			factor = 0.5
			trait = just
		}
		modifier = {
			factor = 0.2
			trait = slow
		}
		modifier = {
			factor = 1.5
			trait = deceitful
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}
		# If there is an antiking faction, prioritize that
		modifier = {
			factor = 0
			has_character_flag = opposes_the_antipope
			OR = {
				religion = catholic
				religion = fraticelli
			}
			liege = {
				religion = ROOT
				rightful_religious_head_scope = {
					vassal_of = PREV
					OR = {
						has_claim = k_papal_state
						has_claim = d_fraticelli
					}
				}
				any_vassal = {
					leads_faction = faction_antiking
				}
			}
		}
		modifier = {
			factor = 0
			has_opinion_modifier = {
				who = LIEGE
				modifier = opinion_coerced_into_leaving_faction
			}
		}
	}
	
	success = {
		always = no
	}
	
	abort = {
		always = no		# Factions will abort if the Potential or Allow triggers are no longer valid
	}
	
	abort_effect = {
	}
	
	effect = {
	}
}

# Antiking Faction
faction_antiking = {
	type = liege_titles
	
	rel_head_loyalist = yes # Members consider the "real" pope to be the rightful religious head
	cancel_on_leader_death = yes # The faction will not automatically continue under a new leader
	
	# Plotter scope
	potential = {
		piety = 100
		is_ruler = yes
		independent = no
		is_landed = yes
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		OR = {
			religion = catholic
			religion = fraticelli
		}
		higher_real_tier_than = COUNT
		liege = {
			religion = ROOT
			rightful_religious_head_scope = {
				vassal_of = PREV
				OR = {
					has_claim = k_papal_state
					has_claim = d_fraticelli
				}
			}
		}
		has_character_flag = took_sides_antipope
		NOT = { has_character_modifier = faction_antiking_ultimatum_timer }
	}
	
	# Target scope
	allow = {
		higher_tier_than = DUKE
		is_primary_holder_title = yes
		holder_scope = {
			independent = yes
			NOT = {
				any_war = {
					war_title = ROOT
					using_cb = cb_install_antiking
				}
			}			
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_leaving_faction
				}
			}
		}
	}
	
	# If false, shows the faction entry for players, but disabled
	player_allow = {
		FROM = {
			piety = 100
			is_ruler = yes
			independent = no
			is_landed = yes
			prisoner = no
			is_adult = yes
			NOT = { trait = incapable }
			OR = {
				religion = catholic
				religion = fraticelli
			}
			higher_real_tier_than = COUNT
			liege = {
				religion = ROOT
				rightful_religious_head_scope = {
					vassal_of = PREV
					OR = {
						has_claim = k_papal_state
						has_claim = d_fraticelli
					}
				}
			}
			has_character_flag = took_sides_antipope
			NOT = { has_character_modifier = faction_antiking_ultimatum_timer }
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			has_regent = no
			NOT = { trait = in_hiding }
			has_character_flag = took_sides_antipope
		}
	}
	
	# AI creation weight - target scope
	chance = {
		factor = 1
		modifier = {
			factor = 0
			FROM = { has_character_flag = supports_the_antipope }
		}
		modifier = {
			factor = 5
			FROM = { has_character_flag = opposes_the_antipope }
		}
		modifier = {
			factor = 0.5
			FROM = {
				NOT = { has_character_flag = supports_the_antipope }
				NOT = { has_character_flag = opposes_the_antipope }
			}
		}
		modifier = {
			factor = 2
			FROM = {
				has_character_flag = opposes_the_antipope
				OR = {
					is_priest = yes
					is_theocracy = yes
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { has_regent = yes }
		}
		modifier = {
			factor = 0
			holder_scope = {
				any_spouse = { character = FROM }
			}
		}
		modifier = {
			factor = 0
			holder_scope = {
				current_heir = { character = FROM }
			}
		}
		modifier = {
			factor = 5
			FROM = { liege = { is_rival = PREV } }
		}
		modifier = {
			factor = 0
			FROM = { opinion = { who = LIEGE value = 50 } }
		}
		modifier = {
			factor = 0.2
			FROM = { opinion = { who = LIEGE value = 5 } }
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = -10 } } }
		}
		modifier = {
			factor = 2.0
			NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
		}
		modifier = {
			factor = 4.0
			NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
		}
		modifier = {
			factor = 0.5
			NOT = { claimed_by = FROM }
		}
		modifier = {
			factor = 0.5
			FROM = { NOT = { trait = zealous } }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = imbecile }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = inbred }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = cynical }
		}
		modifier = {
			factor = 0.2
			FROM = { trait = slow }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = charitable }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = honest }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = humble }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = just }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = proud }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = brave }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = arbitrary }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = zealous }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = impaler }
		}
		modifier = {
			factor = 4.0
			FROM = { trait = ambitious }
		}
		modifier = {
			factor = 0
			FROM = {
				has_opinion_modifier = {
					who = LIEGE
					modifier = opinion_coerced_into_leaving_faction
				}
			}
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title
	membership = {
		factor = 1	
		modifier = {
			factor = 0
			OR = {
				has_regent = yes
				is_landed = no
				preparing_invasion = yes
				NOT = { religion = FROM }
			}
		}
		modifier = {
			factor = 0
			has_character_flag = supports_the_antipope
		}
		modifier = {
			factor = 5
			has_character_flag = opposes_the_antipope
		}
		modifier = {
			factor = 0.5
			NOT = { has_character_flag = supports_the_antipope }
			NOT = { has_character_flag = opposes_the_antipope }
		}
		modifier = {
			factor = 2
			has_character_flag = opposes_the_antipope
			OR = {
				is_priest = yes
				is_theocracy = yes
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = { character = ROOT }
			}
		}
		modifier = {
			factor = 0
			has_character_modifier = faction_antiking_ultimatum_timer
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 50 }
		}
		modifier = {
			factor = 5
			liege = { is_rival = ROOT }
		}
		modifier = {
			factor = 0
			NOT = { opinion = { who = FROM value = -50 } }
		}
		modifier = {
			factor = 0
			has_opinion_modifier = {
				who = LIEGE
				modifier = opinion_coerced_into_leaving_faction
			}
		}
		modifier = {
			factor = 0.2
			opinion = { who = LIEGE value = 5 }
		}
		modifier = {
			factor = 1.5
			NOT = { opinion = { who = LIEGE value = -10 } }
		}
		modifier = {
			factor = 2.0
			NOT = { opinion = { who = LIEGE value = -50 } }
		}
		modifier = {
			factor = 4.0
			NOT = { opinion = { who = LIEGE value = -75 } }
		}
		modifier = {
			factor = 0.5
			NOT = { opinion = { who = FROM value = 0 } }
		}
		modifier = {
			factor = 1.5
			opinion = { who = FROM value = 25 }
		}
		modifier = {
			factor = 1.5
			opinion = { who = FROM value = 50 }
		}
		modifier = {
			factor = 1.5
			opinion = { who = FROM value = 75 }
		}
		modifier = {
			factor = 0.5
			liege = { dynasty = ROOT }
			NOT = { dynasty = FROM }
		}
		modifier = {
			factor = 2
			NOT = { liege = { dynasty = ROOT } }
			dynasty = FROM
		}
		modifier = {
			factor = 0.5
			NOT = { trait = zealous }
		}
		modifier = {
			factor = 0.01
			trait = content
		}
		modifier = {
			factor = 0.01
			trait = imbecile
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0.1
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = cynical
		}
		modifier = {
			factor = 0.2
			trait = slow
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.5
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = kind
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = zealous
		}
		modifier = {
			factor = 2.0
			trait = envious
		}
		modifier = {
			factor = 2.0
			trait = greedy
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}
	}
	
	success = {
		always = no
	}
	
	abort = {
		always = no
	}
	
	abort_effect = {
	}
	
	effect = {
	}
}

# Religious Faction
faction_religious = {
	type = character
	
	# Plotter scope
	potential = {
		is_ruler = yes
		independent = no
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		OR = {
			higher_tier_than = COUNT
			liege = { lower_tier_than = KING }
		}
		liege = {
			independent = yes
			religion_group = ROOT
			NOT = {
				character = ROOT
				religion = ROOT
				any_demesne_title = { temporary = yes }
				has_character_flag = faction_religious_war
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_coerced_into_leaving_faction }
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
			NOT = { trait = in_hiding }
			NOT = { has_opinion_modifier = { who = liege modifier = opinion_coerced_into_leaving_faction } }
			liege = {
				religion_group = ROOT
				NOT = { religion = ROOT }
			}
		}
	}
	
	# AI creation weight (ROOT = faction creator)
	chance = {
		factor = 10
		modifier = {
			factor = 0
			trait = cynical
		}
		modifier = {
			factor = 10
			controls_religion = yes
		}
		modifier = {
			factor = 5
			trait = zealous
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 0.5
			trait = arbitrary
		}
		modifier = {
			factor = 0.5
			trait = slothful
		}
		modifier = {
			factor = 0.1
			trait = humble
		}
		modifier = {
			factor = 0.1
			trait = content
		}
		modifier = {
			factor = 0.1
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = imbecile
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0
			pacifist = yes
		}
		modifier = {
			factor = 0
			opinion = { who = liege value = 0 }
		}
		modifier = {
			factor = 0.5
			opinion = { who = liege value = -25 }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = { character = ROOT }
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 10
		modifier = {
			factor = 0
			NOT = { religion = FROM }
		}
		modifier = {
			factor = 0
			trait = cynical
		}
		modifier = {
			factor = 10
			controls_religion = yes
		}
		modifier = {
			factor = 5
			trait = zealous
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 0.5
			trait = arbitrary
		}
		modifier = {
			factor = 0.5
			trait = slothful
		}
		modifier = {
			factor = 0.1
			trait = humble
		}
		modifier = {
			factor = 0.1
			trait = content
		}
		modifier = {
			factor = 0.1
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = imbecile
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0
			pacifist = yes
		}
		modifier = {
			factor = 0
			opinion = { who = liege value = 0 }
		}
		modifier = {
			factor = 0.5
			opinion = { who = liege value = -25 }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = { character = ROOT }
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

