# Faction tags need to start with 'faction_'

# Supported types:
# liege_titles, liege_titles_w_claimant, character

# The succession law factions have hard coded elements to ensure that the correct heir is shown in Plot and 
# Faction interfaces and that AI faction members vote for laws in accordance with the faction goal.
# The valid tags correspond to the law name: faction_succ_seniority, faction_succ_primogeniture, etc.

###############
# FACTIONS
###############

# Feudal faction: Desires low CA, low feudal taxes and obligations
faction_feudal_emperor = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_feudal = yes
			is_tribal = yes
		}
		is_patrician = no
		independent = no
		liege = {
			tier = emperor
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_feudal_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_feudal_emperor
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_feudal_emperor
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = king
		}
		modifier = {
			factor = 0.1
			tier = count
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { has_character_flag = faction_feudal_supporter } }
		}
		modifier = {
			factor = 0
			ROOT = { 
				liege = {
					current_heir = {
						character = ROOT
					}
				}
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_feudal_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_feudal_king = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_feudal = yes
			is_tribal = yes
		}
		is_patrician = no
		independent = no
		liege = {
			tier = king
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_feudal_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_feudal_king
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_feudal_king
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = duke
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_feudal_supporter }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_feudal_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_feudal_duke = { #just here for the sake of consistency
	type = character

	# Plotter scope
	potential = {
		always = no
	}

	# AI creation weight
	chance = {
		factor = 0
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 0
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

# Republican faction: Desires low CA and city duties
faction_republican_emperor = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = yes
			is_republic = yes
		}
		independent = no
		liege = {
			tier = emperor
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_republican_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_republican_emperor
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_republican_emperor
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = king
		}
		modifier = {
			factor = 0.1
			tier = count
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_republican_supporter }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_republican_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_republican_king = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = yes
			is_republic = yes
		}
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = king
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_republican_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_republican_king
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_republican_king
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = duke
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_republican_supporter }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_republican_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_republican_duke = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = yes
			is_republic = yes
		}
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = duke
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_republican_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_republican_duke
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_republican_duke
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_republican_supporter }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_republican_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

# Religious faction: Desires pious ruler, holy wars
faction_religious_emperor = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = emperor
			religion = ROOT
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_religious_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_religious_emperor
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_religious_emperor
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = king
		}
		modifier = {
			factor = 0.1
			tier = count
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { has_character_flag = faction_religious_supporter } }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { has_character_flag = faction_religious_supporter } }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_religious_king = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = king
			religion = ROOT
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_religious_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_religious_king
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_religious_king
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = duke
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { has_character_flag = faction_religious_supporter } }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { has_character_flag = faction_religious_supporter } }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_religious_duke = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = duke
			religion = ROOT
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_religious_war }
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_religious_duke
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_religious_duke
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { has_character_flag = faction_religious_supporter } }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { has_character_flag = faction_religious_supporter } }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

# Court faction: Desires positions at court and honors from the monarch
faction_court_emperor = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = emperor
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_court_war }
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_court_emperor
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_court_emperor
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		OR = {
			is_feudal = yes
			is_tribal = yes
			liege = {
				is_feudal = no
				is_tribal = no
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = king
		}
		modifier = {
			factor = 0.1
			tier = count
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_court_supporter }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_court_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_court_king = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = king
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_court_war }
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_court_king
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_court_king
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		OR = {
			is_feudal = yes
			is_tribal = yes
			liege = {
				is_feudal = no
				is_tribal = no
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 10
			tier = duke
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_court_supporter }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_court_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

faction_court_duke = {
	type = character

	# Plotter scope
	potential = {
		OR = {
			NOT = { has_character_flag = former_faction_leader }
			had_character_flag = {
				flag = former_faction_leader
				days = 7
			}
		}
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			tier = duke
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_court_war }
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_court_duke
					NOT = { character = ROOT }
				}
			}
		}
		NOT = {
			any_faction_backer = {
				faction = faction_court_duke
				NOT = { has_character_flag = removed_from_leadership }
				higher_real_tier_than = ROOT
			}
		}
		OR = {
			is_feudal = yes
			is_tribal = yes
			liege = {
				is_feudal = no
				is_tribal = no
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_court_supporter }
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = PREV } }
				NOT = { liege = { religion_group = PREV } }
			}
		}
		modifier = {
			factor = 0
			NOT = { has_character_flag = faction_court_supporter }
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			liege = {
				current_heir = {
					character = ROOT
				}
			}
		}
	}

	success = {
		always = no
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

# Separatist faction, forms purely for the purpose of waging an independence war
faction_separatist = {
	type = character

	# Plotter scope
	potential = {
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		liege = {
			independent = yes
			NOT = { character = ROOT }
			NOT = { has_character_flag = faction_separatist_war }	
			# Mongols and Aztecs do not have independence revolt problems before 1350
			OR = {
				year = 1350
				primary_title = { is_tribal_type_title = no }
				NOT = { culture = ROOT }
				NOT = { religion = ROOT }
				NOT = {
					OR = { 
						culture = nahuatl
						culture = mongol
					}
				}
			}
			# Not allowed to start factions like this if our capital borders the liege's capital
			NOT = {
				capital_scope = {
					any_neighbor_province = {
						ROOT = {
							capital_scope = {
								province = PREVPREV
							}
						}
					}
				}
			}			
			NOT = {
				any_demesne_title = {
					temporary = yes
				}
			}
		}
		NOT = {
			liege = {
				any_vassal = {
					leads_faction = faction_separatist
					NOT = { character = ROOT }
				}
			}
		}
	}

	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 100
		modifier = {
			factor = 1.5
			primary_title = {
				is_vice_royalty = yes
			}
		}
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			ROOT = { 
				liege = {
					current_heir = {
						character = ROOT
					}
				}
			}
		}
		#not unless we have a province
		modifier = {
			factor = 0
			NOT = { num_of_count_titles = 1 }
		}
		#wrong culturegroup/religiongroup: different check
		modifier = {
			factor = 0
			OR = {
				NOT = { liege = { culture_group = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			liege = {
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
			}
			OR = {
				leads_faction = faction_pretender
				liege = {
					any_vassal = {
						leads_faction = faction_pretender
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			opinion = { who = liege value = 0 }
		}
		#0 separatism: never
		modifier = {
			factor = 0
			NOT = { check_variable = { which = "separatist_sentiment" value = 0.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
			}
		}
		#1 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 0.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 1.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
					}
					culture = ROOT
					religion = ROOT
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		#2 separatism
		modifier = {
			factor = 0 
			check_variable = { which = "separatist_sentiment" value = 1.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 2.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
					}
					AND = { 
						culture = ROOT
						religion = ROOT
					}
					AND = {
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = -50
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		#3 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 2.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 3.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = -25
						}
					}
					AND = {
						culture = ROOT
						religion = ROOT
						reverse_opinion = {
							who = ROOT
							value = -25
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		#4 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 3.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 4.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = 0
						}
					}
					AND = {
						culture = ROOT
						religion = ROOT
						reverse_opinion = {
							who = ROOT
							value = 0
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
			}
		}
		#5 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 4.05 }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = 25
						}
					}
					AND = {
						culture = ROOT
						religion = ROOT
						reverse_opinion = {
							who = ROOT
							value = 25
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
		}
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 100
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				prisoner = yes
				is_adult = no
				trait = incapable
			}
		}
		modifier = {
			factor = 0
			ROOT = { 
				liege = {
					current_heir = {
						character = ROOT
					}
				}
			}
		}
		#not unless we have a province
		modifier = {
			factor = 0
			NOT = { num_of_count_titles = 1 }
		}
		#wrong culturegroup/religiongroup: different check
		modifier = {
			factor = 0
			OR = {
				NOT = { liege = { culture_group = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			liege = {
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
			}
			OR = {
				leads_faction = faction_pretender
				liege = {
					any_vassal = {
						leads_faction = faction_pretender
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				liege = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
				NOT = { liege = { culture_group = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			opinion = { who = liege value = 0 }
		}
		#0 separatism: never
		modifier = {
			factor = 0
			NOT = { check_variable = { which = "separatist_sentiment" value = 0.05 } }
			liege = { 
				culture_group = ROOT 
				religion_group = ROOT
			}
		}
		#1 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 0.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 1.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
					}
					culture = ROOT
					religion = ROOT
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		#2 separatism
		modifier = {
			factor = 0 
			check_variable = { which = "separatist_sentiment" value = 1.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 2.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
					}
					AND = { 
						culture = ROOT
						religion = ROOT
					}
					AND = {
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = -50
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		#3 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 2.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 3.05 } }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = -25
						}
					}
					AND = {
						culture = ROOT
						religion = ROOT
						reverse_opinion = {
							who = ROOT
							value = -25
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		#4 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 3.05 }
			NOT = { check_variable = { which = "separatist_sentiment" value = 4.05 } }
			liege = {
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = 0
						}
					}
					AND = {
						culture = ROOT
						religion = ROOT
						reverse_opinion = {
							who = ROOT
							value = 0
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
			}
		}
		#5 separatism
		modifier = {
			factor = 0
			check_variable = { which = "separatist_sentiment" value = 4.05 }
			liege = { 
				OR = {
					NOT = { religion_group = pagan_group }
					is_reformed_religion = yes
				}
				culture_group = ROOT 
				religion_group = ROOT
				OR = {
					AND = {
						ROOT = { primary_title = { de_jure_liege_or_above = PREVPREV } }
						ROOT = { any_demesne_province = { has_province_flag = contingent_territory } }
						OR = {
							culture = ROOT
							religion = ROOT
						}
						reverse_opinion = {
							who = ROOT
							value = 25
						}
					}
					AND = {
						culture = ROOT
						religion = ROOT
						reverse_opinion = {
							who = ROOT
							value = 25
						}
					}
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
		}
	}

	success = {
		independent = yes
	}

	abort = {
		always = no
	}

	abort_effect = {
	}

	effect = {
	}
}

# Faction supports claimant to the throne
faction_pretender = {
	type = liege_titles_w_claimant # 'new_character' is a Claimant, or, if the title is Elective, anyone eligible for election
	exclusive = yes # Can only lead or be in one faction of this type

	# Plotter scope
	potential = {
		is_ruler = yes
		OR = {
			is_patrician = no
			is_merchant_republic = yes
		}
		independent = no
		is_landed = yes
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		liege = {
			OR = {
				is_feudal = yes
				is_tribal = yes
			}
			OR = {
				# Hordes should have less problems with this type of faction until ca 1350
				year = 1350
				primary_title = { is_tribal = no }
				NOT = { culture = ROOT }
				NOT = { religion = ROOT }
			}
			NOT = {
				any_demesne_title = {
					temporary = yes
				}
			}
		}
	}

	# Target scope
	allow = {
		is_primary_holder_title_tier = yes
		OR = {
			is_primary_holder_title = yes
			FROM = { 
				primary_title = {
					OR = {
						dejure_liege_title = { title = PREVPREVPREV }
						kingdom = { title = PREVPREVPREV }
						empire = { title = PREVPREVPREV }
					}
				}
			}
		}
		new_character = { prisoner = no }
		NOT = {
			new_character = {
				ROOT = {
					holder_scope = {
						character = PREVPREV
					}
				}
			}
		}
		NOT = {
			AND = {
				NOT = { has_law = succ_feudal_elective }
				current_heir = {
					new_character = {
						character = PREV
					}
				}
			}
		}
		new_character = {
			OR = {
				is_ruler = no
				is_feudal = yes
				is_tribal = yes
			}
		}
		OR = {
			new_character = { is_female = no }
			AND = {
				NOT = { new_character = { religion_group = muslim } }
				NOT = { has_law = agnatic_succession }
			}
		}
		OR = {
			NOT = { has_law = succ_feudal_elective }
			new_character = { is_ruler = no }
			new_character = {
				primary_title = {
					OR = {
						empire = { title = PREVPREVPREV }
						kingdom = { title = PREVPREVPREV }
						dejure_liege_title = { title = PREVPREVPREV }
					}
				}
			}
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			is_adult = yes
			NOT = { trait = incapable }
			prisoner = no
			NOT = { trait = in_hiding }
		}
	}

	# AI creation weight
	chance = {
		factor = 1
		modifier = {
			factor = 0.2
			always = yes
		}
		modifier = {
			factor = 0.1
			NOT = { is_primary_holder_title = yes }
		}
		modifier = {
			factor = 0
			FROM = { controls_religion = yes }
		}
		modifier = {
			factor = 0
			FROM = { 
				OR = {
					trait = incapable
					is_adult = no
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { 
				liege = {
					current_heir = {
						character = FROM
					}
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { FROM = { liege = { culture_group = FROM } } }
				NOT = { FROM = { liege = { religion_group = FROM } } }
			}
			FROM = { opinion = { who = liege value = 25 } }
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { FROM = { liege = { culture_group = FROM } } }
				NOT = { FROM = { liege = { religion_group = FROM } } }
			}
			FROM = { 
				opinion = { who = liege value = 0 } 
				NOT = {
					trait = proud
					trait = ambitious
					trait = envious
					trait = brave
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			FROM = { liege = { culture_group = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = { 
				NOT = {
					OR = {
						leads_faction = faction_feudal_emperor
						leads_faction = faction_feudal_king
						leads_faction = faction_feudal_duke
						leads_faction = faction_republican_emperor
						leads_faction = faction_republican_king
						leads_faction = faction_republican_duke
						leads_faction = faction_court_emperor
						leads_faction = faction_court_king
						leads_faction = faction_court_duke
						leads_faction = faction_religious_emperor
						leads_faction = faction_religious_king
						leads_faction = faction_religious_duke
						AND = {
							OR = {
								in_faction = faction_feudal_emperor
								in_faction = faction_feudal_king
								in_faction = faction_feudal_duke
							}
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_feudal_emperor
									leads_faction = faction_feudal_king
									leads_faction = faction_feudal_duke
								}
							}
						}
						AND = {
							OR = {
								in_faction = faction_republican_emperor
								in_faction = faction_republican_king
								in_faction = faction_republican_duke
							}
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_republican_emperor
									leads_faction = faction_republican_king
									leads_faction = faction_republican_duke
								}
							}
						}
						AND = {
							OR = {
								in_faction = faction_religious_emperor
								in_faction = faction_religious_king
								in_faction = faction_religious_duke
							}
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_religious_emperor
									leads_faction = faction_religious_king
									leads_faction = faction_religious_duke
								}
							}
						}
						AND = {
							OR = {
								in_faction = faction_court_emperor
								in_faction = faction_court_king
								in_faction = faction_court_duke
							}
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_court_emperor
									leads_faction = faction_court_king
									leads_faction = faction_court_duke
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			FROM = { liege = { culture_group = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = { 
				OR = {
					AND = {
						OR = {
							leads_faction = faction_feudal_emperor
							leads_faction = faction_feudal_king
							leads_faction = faction_feudal_duke
						}
						liege = {
							NOT = {
								has_character_flag = faction_feudal_unhappy
								has_character_flag = faction_feudal_angry
							}
						}
					}
					AND = {
						OR = {
							leads_faction = faction_republican_emperor
							leads_faction = faction_republican_king
							leads_faction = faction_republican_duke
						}
						liege = {
							NOT = {
								has_character_flag = faction_republican_unhappy
								has_character_flag = faction_republican_angry
							}
						}
					}
					AND = {
						OR = {
							leads_faction = faction_religious_emperor
							leads_faction = faction_religious_king
							leads_faction = faction_religious_duke
						}
						liege = {
							NOT = {
								has_character_flag = faction_religious_unhappy
								has_character_flag = faction_religious_angry
							}
						}
					}
					AND = {
						OR = {
							leads_faction = faction_court_emperor
							leads_faction = faction_court_king
							leads_faction = faction_court_duke
						}
						liege = {
							NOT = {
								has_character_flag = faction_court_unhappy
								has_character_flag = faction_court_angry
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			NOT = { new_character = { character = FROM } }
			FROM = { liege = { culture_group = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = { 
				OR = {
					AND = {
						OR = {
							leads_faction = faction_feudal_emperor
							leads_faction = faction_feudal_king
							leads_faction = faction_feudal_duke
						}
						liege = {
							has_character_flag = faction_feudal_unhappy
						}
					}
					AND = {
						OR = {
							leads_faction = faction_republican_emperor
							leads_faction = faction_republican_king
							leads_faction = faction_republican_duke
						}
						liege = {
							has_character_flag = faction_feudal_unhappy
						}
					}
					AND = {
						OR = {
							leads_faction = faction_religious_emperor
							leads_faction = faction_religious_king
							leads_faction = faction_religious_duke
						}
						liege = {
							has_character_flag = faction_feudal_unhappy
						}
					}
					AND = {
						OR = {
							leads_faction = faction_court_emperor
							leads_faction = faction_court_king
							leads_faction = faction_court_duke
						}
						liege = {
							has_character_flag = faction_feudal_unhappy
						}
					}
				}
			}
		}
		modifier = {
			factor = 3
			holder_scope = {
				OR = {
					prisoner = yes
					is_adult = no
					trait = incapable
				}
			}
		}
		modifier = {
			factor = 2
			new_character = { has_character_flag = justified_claimant }
		}
		modifier = {
			factor = 10
			new_character = { character = FROM }
		}
		modifier = {
			factor = 3
			FROM = {
				OR = {
					leads_faction = faction_court_emperor
					leads_faction = faction_court_king
					leads_faction = faction_court_duke
				}
			}
		}
		modifier = {
			factor = 2
			FROM = { 
				OR = {
					leads_faction = faction_religious_emperor
					leads_faction = faction_religious_king
					leads_faction = faction_religious_duke
				}
				liege = { trait = excommunicated }
			}
		}
		modifier = {
			factor = 0.5
			FROM = { 
				OR = {
					leads_faction = faction_religious_emperor
					leads_faction = faction_religious_king
					leads_faction = faction_religious_duke
				}
				liege = { NOT = { trait = excommunicated } }
			}
		}
		modifier = {
			factor = 0.25
			FROM = {
				OR = {
					leads_faction = faction_republican_emperor
					leads_faction = faction_republican_king
					leads_faction = faction_republican_duke
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				OR = {
					trait = content
					trait = humble
					trait = slothful
					trait = craven
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			new_character = {
				NOT = { culture_group = FROM }
			}
		}
		modifier = {
			factor = 0.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				NOT = { culture = FROM }
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			new_character = {
				NOT = { religion = FROM }
			}
		}
		modifier = {
			factor = 0.1
			NOT = { new_character = { character = FROM } }
			NOT = {
				new_character = {
					FROM = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 10 # I don't like the pretender enough
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 25
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 50
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 75
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			new_character = {
				FROM = {
					opinion_diff = {
						first = PREV
						second = LIEGE
						value = 100
						as_if_liege = yes
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						opinion = {
							who = PREV
							value = 50
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						opinion = {
							who = PREV
							value = 25
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = 0
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = -25
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = -50
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { new_character = { character = FROM } }
			FROM = {
				liege = {
					new_character = {
						NOT = {
							opinion = {
								who = PREV
								value = -75
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			new_character = { is_female = yes }
			NOT = { has_law = true_cognatic_succession }
		}
		modifier = {
			factor = 0
			new_character = {
				FROM = {
					liege = {
						OR = {
							is_father = PREVPREV
							is_mother = PREVPREV
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.1
			holder_scope = {
				dynasty = FROM
				religion = FROM
				culture = FROM
			}
			new_character = {
				NOT = { dynasty = FROM }
			}
		}
		modifier = {
			factor = 0
			new_character = {
				OR = {
					trait = blinded
					trait = eunuch
					trait = incapable
					trait = imbecile
					trait = inbred
					AND = {
						is_female = yes
						age = 40
					}
				}
			}
		}
		modifier = {
			factor = 3.0
			new_character = { character = FROM }
			FROM = { trait = ambitious }
		}
		modifier = {
			factor = 1.5
			new_character = { is_close_relative = FROM }
		}
		modifier = {
			factor = 0.75
			NOT = { new_character = { is_close_relative = FROM } }
		}
		modifier = {
			factor = 0
			new_character = { character = FROM }
			FROM = { trait = content }
		}
		modifier = {
			factor = 0
			new_character = { character = FROM }
			FROM = { liege = { culture_group = PREV } }
			FROM = { liege = { religion_group = PREV } }
			FROM = {
				opinion = {
					who = liege
					value = -50
				}
				NOT = {
					OR = {
						AND = {
							OR = {
								leads_faction = faction_feudal_emperor
								leads_faction = faction_feudal_king
								leads_faction = faction_feudal_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_feudal_unhappy
									has_character_flag = faction_feudal_angry
								}
							}
						}
						AND = {
							OR = {
								leads_faction = faction_republican_emperor
								leads_faction = faction_republican_king
								leads_faction = faction_republican_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_republican_unhappy
									has_character_flag = faction_republican_angry
								}
							}
						}
						AND = {
							OR = {
								leads_faction = faction_religious_emperor
								leads_faction = faction_religious_king
								leads_faction = faction_religious_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_religious_unhappy
									has_character_flag = faction_religious_angry
								}
							}
						}
						AND = {
							OR = {
								leads_faction = faction_court_emperor
								leads_faction = faction_court_king
								leads_faction = faction_court_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_court_unhappy
									has_character_flag = faction_court_angry
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			new_character = { character = FROM }
			FROM = {
				opinion = {
					who = liege
					value = -25
				}
				NOT = {
					OR = {
						AND = {
							OR = {
								leads_faction = faction_feudal_emperor
								leads_faction = faction_feudal_king
								leads_faction = faction_feudal_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_feudal_angry
								}
							}
						}
						AND = {
							OR = {
								leads_faction = faction_republican_emperor
								leads_faction = faction_republican_king
								leads_faction = faction_republican_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_republican_angry
								}
							}
						}
						AND = {
							OR = {
								leads_faction = faction_religious_emperor
								leads_faction = faction_religious_king
								leads_faction = faction_religious_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_religious_angry
								}
							}
						}
						AND = {
							OR = {
								leads_faction = faction_court_emperor
								leads_faction = faction_court_king
								leads_faction = faction_court_duke
							}
							liege = {
								NOT = {
									has_character_flag = faction_court_angry
								}
							}
						}
					}
				}
			}
		}
		# If there is an antiking faction, prioritize that
		modifier = {
			factor = 0
			FROM = {
				has_character_flag = opposes_the_antipope
				OR = {
					religion = catholic
					religion = fraticelli
				}
				liege = {
					religion = FROM
					rightful_religious_head_scope = {
						vassal_of = PREV
						OR = {
							has_claim = k_papal_state
							has_claim = d_fraticelli
						}
					}
					any_vassal = {
						leads_faction = faction_antiking
					}
				}
			}
		}		
	}

	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
	membership = {
		factor = 1
		modifier = {
			factor = 0
			controls_religion = yes
		}
		modifier = {
			factor = 0
			OR = {
				trait = incapable
				is_adult = no
			}
		}
		modifier = {
			factor = 0
			ROOT = { 
				liege = {
					current_heir = {
						character = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROMFROM = { is_conquered = yes }
			FROM = { 
				supported_claimant = {
					NOT = { culture = ROOT }
				} 
			}
		}
		modifier = {
			factor = 0
			prisoner = yes
		}
		#different culture group: uses another calc
		modifier = {
			factor = 100
			OR = {
				NOT = { liege = { culture_group = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			FROM = { 
				supported_claimant = {
					culture = ROOT
					religion = ROOT
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { liege = { culture_group = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			opinion = { who = liege value = 25 }
		}
		modifier = {
			factor = 0
			OR = {
				NOT = { liege = { culture_group = ROOT } }
				NOT = { liege = { religion_group = ROOT } }
			}
			ROOT = { 
				opinion = { who = liege value = 0 } 
				NOT = {
					trait = proud
					trait = ambitious
					trait = envious
					trait = brave
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			liege = { culture_group = ROOT }
			liege = { religion_group = ROOT }
			ROOT = { 
				NOT = {
					OR = {
						leads_faction = faction_feudal_emperor
						leads_faction = faction_feudal_king
						leads_faction = faction_feudal_duke
						leads_faction = faction_republican_emperor
						leads_faction = faction_republican_king
						leads_faction = faction_republican_duke
						leads_faction = faction_court_emperor
						leads_faction = faction_court_king
						leads_faction = faction_court_duke
						leads_faction = faction_religious_emperor
						leads_faction = faction_religious_king
						leads_faction = faction_religious_duke
						AND = {
							OR = {
								in_faction = faction_feudal_emperor
								in_faction = faction_feudal_king
								in_faction = faction_feudal_duke
							}
							FROM = {
								OR = {
									leads_faction = faction_feudal_emperor
									leads_faction = faction_feudal_king
									leads_faction = faction_feudal_duke
									any_faction_backer = {
										faction = faction_pretender
										OR = {
											leads_faction = faction_feudal_emperor
											leads_faction = faction_feudal_king
											leads_faction = faction_feudal_duke
										}
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_feudal_angry }
								}
							}
						}
						AND = {
							OR = {
								in_faction = faction_republican_emperor
								in_faction = faction_republican_king
								in_faction = faction_republican_duke
							}
							FROM = {
								OR = {
									leads_faction = faction_republican_emperor
									leads_faction = faction_republican_king
									leads_faction = faction_republican_duke
									any_faction_backer = {
										faction = faction_pretender
										OR = {
											leads_faction = faction_republican_emperor
											leads_faction = faction_republican_king
											leads_faction = faction_republican_duke
										}
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_republican_angry }
								}
							}
						}
						AND = {
							OR = {
								in_faction = faction_religious_emperor
								in_faction = faction_religious_king
								in_faction = faction_religious_duke
							}
							FROM = {
								OR = {
									leads_faction = faction_religious_emperor
									leads_faction = faction_religious_king
									leads_faction = faction_religious_duke
									any_faction_backer = {
										faction = faction_pretender
										OR = {
											leads_faction = faction_religious_emperor
											leads_faction = faction_religious_king
											leads_faction = faction_religious_duke
										}
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_religious_angry }
								}
							}
						}
						AND = {
							OR = {
								in_faction = faction_court_emperor
								in_faction = faction_court_king
								in_faction = faction_court_duke
							}
							FROM = {
								OR = {
									leads_faction = faction_court_emperor
									leads_faction = faction_court_king
									leads_faction = faction_court_duke
									any_faction_backer = {
										faction = faction_pretender
										OR = {
											leads_faction = faction_court_emperor
											leads_faction = faction_court_king
											leads_faction = faction_court_duke
										}
									}
								}
								OR = {
									ai = yes
									liege = { has_character_flag = faction_court_angry }
								}
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 100
			OR = {
				FROM = { supported_claimant = { character = ROOT } }
				AND = {
					OR = {
						in_faction = faction_feudal_emperor
						in_faction = faction_feudal_king
						in_faction = faction_feudal_duke
					}
					FROM = {
						OR = {
							leads_faction = faction_feudal_emperor
							leads_faction = faction_feudal_king
							leads_faction = faction_feudal_duke
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_feudal_emperor
									leads_faction = faction_feudal_king
									leads_faction = faction_feudal_duke
								}
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_feudal_angry }
						}
					}
				}
				AND = {
					OR = {
						in_faction = faction_republican_emperor
						in_faction = faction_republican_king
						in_faction = faction_republican_duke
					}
					FROM = {
						OR = {
							leads_faction = faction_republican_emperor
							leads_faction = faction_republican_king
							leads_faction = faction_republican_duke
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_republican_emperor
									leads_faction = faction_republican_king
									leads_faction = faction_republican_duke
								}
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_republican_angry }
						}
					}
				}
				AND = {
					OR = {
						in_faction = faction_religious_emperor
						in_faction = faction_religious_king
						in_faction = faction_religious_duke
					}
					FROM = {
						OR = {
							leads_faction = faction_religious_emperor
							leads_faction = faction_religious_king
							leads_faction = faction_religious_duke
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_religious_emperor
									leads_faction = faction_religious_king
									leads_faction = faction_religious_duke
								}
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_religious_angry }
						}
					}
				}
				AND = {
					OR = {
						in_faction = faction_court_emperor
						in_faction = faction_court_king
						in_faction = faction_court_duke
					}
					FROM = {
						OR = {
							leads_faction = faction_court_emperor
							leads_faction = faction_court_king
							leads_faction = faction_court_duke
							any_faction_backer = {
								faction = faction_pretender
								OR = {
									leads_faction = faction_court_emperor
									leads_faction = faction_court_king
									leads_faction = faction_court_duke
								}
							}
						}
						OR = {
							ai = yes
							liege = { has_character_flag = faction_court_angry }
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			liege = { culture_group = ROOT }
			liege = { religion_group = ROOT }
			OR = {
				AND = {
					OR = {
						leads_faction = faction_feudal_emperor
						leads_faction = faction_feudal_king
						leads_faction = faction_feudal_duke
					}
					liege = {
						NOT = {
							has_character_flag = faction_feudal_unhappy
							has_character_flag = faction_feudal_angry
						}
					}
				}
				AND = {
					OR = {
						leads_faction = faction_republican_emperor
						leads_faction = faction_republican_king
						leads_faction = faction_republican_duke
					}
					liege = {
						NOT = {
							has_character_flag = faction_republican_unhappy
							has_character_flag = faction_republican_angry
						}
					}
				}
				AND = {
					OR = {
						leads_faction = faction_religious_emperor
						leads_faction = faction_religious_king
						leads_faction = faction_religious_duke
					}
					liege = {
						NOT = {
							has_character_flag = faction_religious_unhappy
							has_character_flag = faction_religious_angry
						}
					}
				}
				AND = {
					OR = {
						leads_faction = faction_court_emperor
						leads_faction = faction_court_king
						leads_faction = faction_court_duke
					}
					liege = {
						NOT = {
							has_character_flag = faction_court_unhappy
							has_character_flag = faction_court_angry
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.25
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			liege = { culture_group = ROOT }
			liege = { religion_group = ROOT }
			OR = {
				AND = {
					OR = {
						leads_faction = faction_feudal_emperor
						leads_faction = faction_feudal_king
						leads_faction = faction_feudal_duke
					}
					liege = {
						has_character_flag = faction_feudal_unhappy
					}
				}
				AND = {
					OR = {
						leads_faction = faction_republican_emperor
						leads_faction = faction_republican_king
						leads_faction = faction_republican_duke
					}
					liege = {
						has_character_flag = faction_feudal_unhappy
					}
				}
				AND = {
					OR = {
						leads_faction = faction_religious_emperor
						leads_faction = faction_religious_king
						leads_faction = faction_religious_duke
					}
					liege = {
						has_character_flag = faction_feudal_unhappy
					}
				}
				AND = {
					OR = {
						leads_faction = faction_court_emperor
						leads_faction = faction_court_king
						leads_faction = faction_court_duke
					}
					liege = {
						has_character_flag = faction_feudal_unhappy
					}
				}
			}
		}
		modifier = {
			factor = 3
			FROMFROM = { holder_scope = { regent = { is_alive = yes } } }
		}
		modifier = {
			factor = 3
			FROM = {
				OR = {
					leads_faction = faction_court_emperor
					leads_faction = faction_court_king
					leads_faction = faction_court_duke
				}
			}
		}
		modifier = {
			factor = 2
			FROM = {
				OR = {
					leads_faction = faction_religious_emperor
					leads_faction = faction_religious_king
					leads_faction = faction_religious_duke
				}
				liege = { trait = excommunicated }
			}
		}
		modifier = {
			factor = 0.5
			FROM = {
				OR = {
					leads_faction = faction_religious_emperor
					leads_faction = faction_religious_king
					leads_faction = faction_religious_duke
				}
				liege = { NOT = { trait = excommunicated } }
			}
		}
		modifier = {
			factor = 0.25
			FROM = {
				OR = {
					leads_faction = faction_republican_emperor
					leads_faction = faction_republican_king
					leads_faction = faction_republican_duke
				}
			}
		}
		modifier = {
			factor = 2
			FROM = { supported_claimant = { has_character_flag = justified_claimant } }
		}
		modifier = {
			factor = 1.5
			FROM = { supported_claimant = { is_close_relative = ROOT } }
		}
		modifier = {
			factor = 0.75
			FROM = { NOT = { supported_claimant = { is_close_relative = ROOT } } }
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					NOT = { culture_group = ROOT }
				}
			}
		}
		modifier = {
			factor = 0.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					NOT = { culture = ROOT }
				}
			}
		}
		modifier = {
			factor = 0
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					NOT = { religion = ROOT }
				}
			}
		}
		modifier = {
			factor = 0.1
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			NOT = {
				FROM = {
					supported_claimant = {
						ROOT = {
							opinion_diff = {
								first = PREV
								second = LIEGE
								value = 10
								as_if_liege = yes
							}
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 25
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 50
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 75
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { supported_claimant = { character = ROOT } } }
			FROM = {
				supported_claimant = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 100
							as_if_liege = yes
						}
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			FROM = { supported_claimant = { is_female = yes } }
			NOT = { FROMFROM = { has_law = true_cognatic_succession } }
		}
		modifier = {
			factor = 2.0
			FROMFROM = {
				new_character = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 40
							as_if_liege = yes
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 2.0
			FROMFROM = {
				new_character = {
					ROOT = {
						opinion_diff = {
							first = PREV
							second = LIEGE
							value = 60
							as_if_liege = yes
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 0.01
			trait = content
			FROMFROM = {
				OR = {
					is_conquered = no
					conquest_culture = ROOT
				}
			}
		}
		
		modifier = {
			factor = 2.0
			liege = {
				dynasty_realm_power = 0.25
			}
			FROMFROM = {
				new_character = {
					ROOT = {
						liege = { 
							NOT = { dynasty = PREVPREV }
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 2.0
			liege = {
				dynasty_realm_power = 0.4
			}
			FROMFROM = {
				new_character = {
					ROOT = {
						liege = { 
							NOT = { dynasty = PREVPREV }
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 0.01
			trait = imbecile
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0.1
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = content
		}
		modifier = {
			factor = 0.5
			trait = humble
		}
		modifier = {
			factor = 0.5
			trait = just
		}
		modifier = {
			factor = 0.2
			trait = slow
		}
		modifier = {
			factor = 1.5
			trait = deceitful
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}
		# If there is an antiking faction, prioritize that
		modifier = {
			factor = 0
			has_character_flag = opposes_the_antipope
			OR = {
				religion = catholic
				religion = fraticelli
			}
			liege = {
				religion = ROOT
				rightful_religious_head_scope = {
					vassal_of = PREV
					OR = {
						has_claim = k_papal_state
						has_claim = d_fraticelli
					}
				}
				any_vassal = {
					leads_faction = faction_antiking
				}
			}
		}
	}
	
	success = {
		always = no
	}
	
	abort = {
		always = no		# Factions will abort if the Potential or Allow triggers are no longer valid
	}
	
	abort_effect = {
	}
	
	effect = {
	}
}

# Antiking Faction
faction_antiking = {
	type = liege_titles
	
	rel_head_loyalist = yes # Members consider the "real" pope to be the rightful religious head
	cancel_on_leader_death = yes # The faction will not automatically continue under a new leader
	
	# Plotter scope
	potential = {
		piety = 100
		is_ruler = yes
		independent = no
		is_landed = yes
		prisoner = no
		is_adult = yes
		NOT = { trait = incapable }
		OR = {
			religion = catholic
			religion = fraticelli
		}
		higher_real_tier_than = COUNT
		liege = {
			religion = ROOT
			rightful_religious_head_scope = {
				vassal_of = PREV
				OR = {
					has_claim = k_papal_state
					has_claim = d_fraticelli
				}
			}
		}
		has_character_flag = took_sides_antipope
		NOT = { has_character_modifier = faction_antiking_ultimatum_timer }
	}
	
	# Target scope
	allow = {
		higher_tier_than = DUKE
		is_primary_holder_title = yes
		holder_scope = {
			independent = yes
			NOT = {
				any_war = {
					war_title = ROOT
					using_cb = cb_install_antiking
				}
			}			
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_leaving_faction
				}
			}
		}
	}
	
	# If false, shows the faction entry for players, but disabled
	player_allow = {
		FROM = {
			piety = 100
			is_ruler = yes
			independent = no
			is_landed = yes
			prisoner = no
			is_adult = yes
			NOT = { trait = incapable }
			OR = {
				religion = catholic
				religion = fraticelli
			}
			higher_real_tier_than = COUNT
			liege = {
				religion = ROOT
				rightful_religious_head_scope = {
					vassal_of = PREV
					OR = {
						has_claim = k_papal_state
						has_claim = d_fraticelli
					}
				}
			}
			has_character_flag = took_sides_antipope
			NOT = { has_character_modifier = faction_antiking_ultimatum_timer }
		}
	}
	
	# Faction member scope (ROOT = joiner, FROM = target)
	allow_join = {
		ROOT = {
			is_ruler = yes
			independent = no
			is_landed = yes
			has_regent = no
			NOT = { trait = in_hiding }
			has_character_flag = took_sides_antipope
		}
	}
	
	# AI creation weight - target scope
	chance = {
		factor = 1
		modifier = {
			factor = 0
			FROM = { has_character_flag = supports_the_antipope }
		}
		modifier = {
			factor = 5
			FROM = { has_character_flag = opposes_the_antipope }
		}
		modifier = {
			factor = 0.5
			FROM = {
				NOT = { has_character_flag = supports_the_antipope }
				NOT = { has_character_flag = opposes_the_antipope }
			}
		}
		modifier = {
			factor = 2
			FROM = {
				has_character_flag = opposes_the_antipope
				OR = {
					is_priest = yes
					is_theocracy = yes
				}
			}
		}
		modifier = {
			factor = 0
			FROM = { has_regent = yes }
		}
		modifier = {
			factor = 0
			holder_scope = {
				any_spouse = { character = FROM }
			}
		}
		modifier = {
			factor = 0
			holder_scope = {
				current_heir = { character = FROM }
			}
		}
		modifier = {
			factor = 5
			FROM = { liege = { is_rival = PREV } }
		}
		modifier = {
			factor = 0
			FROM = { opinion = { who = LIEGE value = 50 } }
		}
		modifier = {
			factor = 0.2
			FROM = { opinion = { who = LIEGE value = 5 } }
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = -10 } } }
		}
		modifier = {
			factor = 2.0
			NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
		}
		modifier = {
			factor = 4.0
			NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
		}
		modifier = {
			factor = 0.5
			NOT = { claimed_by = FROM }
		}
		modifier = {
			factor = 0.5
			FROM = { NOT = { trait = zealous } }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.01
			FROM = { trait = imbecile }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = inbred }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = craven }
		}
		modifier = {
			factor = 0.1
			FROM = { trait = cynical }
		}
		modifier = {
			factor = 0.2
			FROM = { trait = slow }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = charitable }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = honest }
		}
		modifier = {
			factor = 0.5
			FROM = { trait = humble }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0.75
			FROM = { trait = just }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = proud }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = brave }
		}
		modifier = {
			factor = 1.5
			FROM = { trait = arbitrary }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = zealous }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = greedy }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = impaler }
		}
		modifier = {
			factor = 4.0
			FROM = { trait = ambitious }
		}
	}
	
	# AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title
	membership = {
		factor = 1	
		modifier = {
			factor = 0
			OR = {
				has_regent = yes
				is_landed = no
				preparing_invasion = yes
				NOT = { religion = FROM }
			}
		}
		modifier = {
			factor = 0
			has_character_flag = supports_the_antipope
		}
		modifier = {
			factor = 5
			has_character_flag = opposes_the_antipope
		}
		modifier = {
			factor = 0.5
			NOT = { has_character_flag = supports_the_antipope }
			NOT = { has_character_flag = opposes_the_antipope }
		}
		modifier = {
			factor = 2
			has_character_flag = opposes_the_antipope
			OR = {
				is_priest = yes
				is_theocracy = yes
			}
		}
		modifier = {
			factor = 0
			FROMFROM = {
				current_heir = { character = ROOT }
			}
		}
		modifier = {
			factor = 0
			has_character_modifier = faction_antiking_ultimatum_timer
		}
		modifier = {
			factor = 0
			opinion = { who = LIEGE value = 50 }
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		modifier = {
			factor = 5
			liege = { is_rival = ROOT }
		}
		modifier = {
			factor = 0
			NOT = { opinion = { who = FROM value = -50 } }
			NOT = {	
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_coerced_into_joining_faction
				}
			}
		}
		modifier = {
			factor = 0
			has_opinion_modifier = {
				who = LIEGE
				modifier = opinion_coerced_into_leaving_faction
			}
		}
		modifier = {
			factor = 0.2
			opinion = { who = LIEGE value = 5 }
		}
		modifier = {
			factor = 10000
			has_opinion_modifier = {
				who = FROM
				modifier = opinion_coerced_into_joining_faction
			}
		}
		modifier = {
			factor = 1.5
			NOT = { opinion = { who = LIEGE value = -10 } }
		}
		modifier = {
			factor = 2.0
			NOT = { opinion = { who = LIEGE value = -50 } }
		}
		modifier = {
			factor = 4.0
			NOT = { opinion = { who = LIEGE value = -75 } }
		}
		modifier = {
			factor = 0.5
			NOT = { opinion = { who = FROM value = 0 } }
		}
		modifier = {
			factor = 1.5
			opinion = { who = FROM value = 25 }
		}
		modifier = {
			factor = 1.5
			opinion = { who = FROM value = 50 }
		}
		modifier = {
			factor = 1.5
			opinion = { who = FROM value = 75 }
		}
		modifier = {
			factor = 0.5
			liege = { dynasty = ROOT }
			NOT = { dynasty = FROM }
		}
		modifier = {
			factor = 2
			NOT = { liege = { dynasty = ROOT } }
			dynasty = FROM
		}
		modifier = {
			factor = 0.5
			NOT = { trait = zealous }
		}
		modifier = {
			factor = 0.01
			trait = content
		}
		modifier = {
			factor = 0.01
			trait = imbecile
		}
		modifier = {
			factor = 0.1
			trait = inbred
		}
		modifier = {
			factor = 0.1
			trait = craven
		}
		modifier = {
			factor = 0.1
			trait = cynical
		}
		modifier = {
			factor = 0.2
			trait = slow
		}
		modifier = {
			factor = 0.5
			trait = charitable
		}
		modifier = {
			factor = 0.5
			trait = honest
		}
		modifier = {
			factor = 0.5
			trait = humble
		}
		modifier = {
			factor = 0.75
			trait = kind
		}
		modifier = {
			factor = 0.75
			trait = just
		}
		modifier = {
			factor = 1.5
			trait = proud
		}
		modifier = {
			factor = 1.5
			trait = brave
		}
		modifier = {
			factor = 1.5
			trait = arbitrary
		}
		modifier = {
			factor = 2.0
			trait = zealous
		}
		modifier = {
			factor = 2.0
			trait = envious
		}
		modifier = {
			factor = 2.0
			trait = greedy
		}
		modifier = {
			factor = 2.0
			trait = impaler
		}
		modifier = {
			factor = 4.0
			trait = ambitious
		}
	}
	
	success = {
		always = no
	}
	
	abort = {
		always = no
	}
	
	abort_effect = {
	}
	
	effect = {
	}
}
