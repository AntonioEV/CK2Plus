# Decisions for Additional Objectives Mod - by JGCrusader

decisions = {

	reveal_plots_dec = {
		potential = {
			ai = no
			has_ambition = obj_uncover_plot
		}

		allow = {
			any_backed_character = {
				NOT = { is_liege_of = ROOT }
				NOT = { character = ROOT }
				OR = {
					has_plot = plot_seize_trade_post
					has_plot = plot_discredit_councillor
					has_plot = plot_embezzle_from_liege
					has_plot = plot_kidnapping
					has_plot = plot_fabricate_treason
					has_plot = plot_fabricate_treason_liege
					has_plot = plot_fabricate_heresy
					has_plot = plot_gain_liege_title
					has_plot = plot_gain_fellow_vassal_title
					has_plot = plot_weaken_fellow_vassal
					has_plot = plot_kidnap_liege
					has_plot = plot_kill_character
					has_plot = plot_take_revenge
					has_plot = plot_kill_spouse
					has_plot = plot_seduce
				}
				NOT = { has_character_flag = event7040 }
				plot_target_char = { ai = yes }
			}
		}

		effect = {
			any_backed_character = {
				if = {
					limit = {
						NOT = { is_liege_of = ROOT }
						NOT = { character = ROOT }
						OR = {
							has_plot = plot_seize_trade_post
							has_plot = plot_discredit_councillor
							has_plot = plot_embezzle_from_liege
							has_plot = plot_kidnapping
							has_plot = plot_fabricate_treason
							has_plot = plot_fabricate_treason_liege
							has_plot = plot_fabricate_heresy
							has_plot = plot_gain_liege_title
							has_plot = plot_gain_fellow_vassal_title
							has_plot = plot_weaken_fellow_vassal
							has_plot = plot_kidnap_liege
							has_plot = plot_kill_character
							has_plot = plot_take_revenge
							has_plot = plot_kill_spouse
							has_plot = plot_seduce
						}
						NOT = { has_character_flag = event7040 }
						plot_target_char = { ai = yes }
					}
					opinion = {
						who = ROOT
						modifier = revealed_plot
						months = 120
					}
					set_character_flag = event7040  # Marked a plotter as having his plot revealed
					character_event = { id = Plus.453 days = 1 tooltip = uncovered_tooltip }
					plot_target_char = {
						letter_event = { id = Plus.454 days = 1 tooltip = tipped_off_tooltip }
					}
				}
			}
			add_trait = counterspy
		}

		ai_will_do = {
			factor = 0
		}
	}

	request_legit_for_son = {
		potential = {
			has_ambition = obj_bastard_legit
			is_female = yes
			any_child = {
				is_alive = yes
				is_female = no
				trait = bastard
				father = {
					is_alive = yes
					is_ruler = yes
					is_liege_of = PREV
					dynasty = PREV
				}
			}
			hidden_tooltip = {
				NOT = { has_character_modifier = bastard_legit_request_timer }
			}
		}

		allow = {
			any_child = {
				age = 10
				is_alive = yes
				is_female = no
				trait = bastard
				father = {
					is_alive = yes
					is_ruler = yes
					is_liege_of = PREV
					dynasty = PREV
				}
			}
		}

		effect = {
			random_child = {
				limit = {
					age = 10
					is_alive = yes
					is_female = no
					trait = bastard
					father = {
						is_alive = yes
						is_ruler = yes
						is_liege_of = PREV
						dynasty = PREV
					}
				}
				character_event = { id = Plus.460 days = 1 tooltip = bastard_chain_tooltip }
			}
			hidden_tooltip = {
				add_character_modifier = {
					name = "bastard_legit_request_timer"
					duration = 365
					hidden = yes
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				trait = content
			}
			modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}

	employ_court_jester = {
		potential = {
			is_ruler = yes
			is_feudal = yes
			ai = yes
			higher_tier_than = DUKE
			OR = {
				religion_group = christian
				religion_group = jewish_group
				religion_group = pagan_group
				religion_group = indian_group
			}
			NOT = {
				any_vassal = { has_minor_title = title_court_jester }
				any_courtier = { has_minor_title = title_court_jester }
			}
		}
		allow = {
			war = no
			scaled_wealth = 4.0
		}
		effect = {
			wealth = -10
			create_random_diplomat = {
				female = no
				random_traits = yes
				trait = content
				dynasty = random
				attributes = {
					diplomacy = 1
					martial = 1
					stewardship = 1
					intrigue = 1
					learning = 1
				}
			}
			new_character = {
				give_minor_title = title_court_jester
				if = {
					limit = { trait = grey_eminence }
					remove_trait = grey_eminence
					add_trait = naive_appeaser
				}
				if = {
					limit = { trait = charismatic_negotiator }
					remove_trait = charismatic_negotiator
					add_trait = naive_appeaser
				}
				if = {
					limit = { trait = underhanded_rogue }
					remove_trait = underhanded_rogue
					add_trait = naive_appeaser
				}
				if = {
					limit = {
						NOT = { trait = imbecile }
					}
					random = {
						chance = 30
						add_trait = imbecile
					}
				}
				if = {
					limit = {
						NOT = { trait = imbecile }
						NOT = { trait = slow }
					}
					random = {
						chance = 50
						add_trait = slow
					}
				}
				if = {
					limit = {
						NOT = { trait = imbecile }
						NOT = { trait = slow }
						NOT = { trait = quick }
					}
					random = {
						chance = 10
						add_trait = quick
					}
				}
				if ={
					limit = { ROOT = { religion_group = jewish_group } }
					random = {
						chance = 70
						add_trait = yehudi
						set_character_flag = yehudi_check
					}
				}
				if = {
					limit = { religion_group = indian_group }
					add_trait = kshatriya
					character_event = { id = RoI.30121 }
				}
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1
		}
	}

}