decisions = {

	ai_monk_title_gain = {
		is_high_prio = yes
		potential = {
			ai = yes
			is_ruler = no
			religion_group = christian
			OR = {
				AND = {
					trait = monk
					NOT = { has_character_flag = title_monk }
				}
				AND = {
					trait = nun
					NOT = { has_character_flag = title_nun }
				}
				AND = {
					trait = perfecti
					is_female = no
					NOT = { has_character_flag = title_monk }
				}
				AND = {
					trait = perfecti
					is_female = yes
					NOT = { has_character_flag = title_nun }
				}
			}
			NOR = {
				has_landed_title = d_pentarch_rome
				has_landed_title = d_pentarch_alexandria
			}
		}
		allow = {
			always = yes
		}
		effect = {
			if = {
				limit = { trait = monk }
				set_character_flag = title_monk
				set_special_character_title = MONK_BROTHER
			}
			if = {
				limit = { trait = nun }
				set_character_flag = title_nun
				set_special_character_title = NUN_SISTER
			}
			if = {
				limit = {
					trait = perfecti
					is_female = no
				}
				set_character_flag = title_monk
				set_special_character_title = MONK_BROTHER
			}
			if = {
				limit = {
					trait = perfecti
					is_female = yes
				}
				set_character_flag = title_nun
				set_special_character_title = NUN_SISTER
			}
		}
	}
	
	ai_monk_title_lose = {
		is_high_prio = yes
		potential = {
			ai = yes
			religion_group = christian
			OR = {
				AND = {
					NOT = { trait = monk }
					NOT = { trait = perfecti }
					has_character_flag = title_monk
				}
				AND = {
					NOT = { trait = nun }
					NOT = { trait = perfecti }
					has_character_flag = title_nun
				}
				AND = {
					is_ruler = yes
					OR = {
						has_character_flag = title_monk
						has_character_flag = title_nun
					}
				}
			}
		}
		allow = {
			always = yes
		}
		effect = {
			if = {
				limit = { is_female = no }
				clr_character_flag = title_monk
				remove_special_character_title = MONK_BROTHER
			}
			if = {
				limit = { is_female = yes }
				clr_character_flag = title_nun
				remove_special_character_title = NUN_SISTER
			}
		}
	}

	ai_desert_father_title_lose = {
		is_high_prio = yes
		potential = {
			ai = yes
			OR = {
				AND = {
					NOT = { trait = desert_father }
					has_character_flag = title_desert_father
				}
				AND = {
					NOT = { trait = desert_mother }
					has_character_flag = title_desert_mother
				}
				AND = {
					is_ruler = yes
					OR = {
						has_character_flag = title_desert_father
						has_character_flag = title_desert_mother
					}
				}
			}
		}
		allow = {
			always = yes
		}
		effect = {
			clr_character_flag = is_desert_mother_father
			if = {
				limit = { is_female = no }
				clr_character_flag = title_desert_father
				remove_special_character_title = DESERT_FATHER_TITLE
			}
			if = {
				limit = { is_female = yes }
				clr_character_flag = title_desert_mother
				remove_special_character_title = DESERT_MOTHER_TITLE
			}
		}
	}
	
	ai_become_monk = {
		potential = {
			ai = yes
			religion_group = christian
			is_adult = yes
			is_ruler = no
			prisoner = no
			OR = {
				trait = detached_priest
				trait = martial_cleric
				trait = scholarly_theologian
				trait = mastermind_theologian
				trait = zealous
				has_job_title = job_spiritual
			}
			NOR = {
				trait = cynical
				trait = ambitious
				trait = incapable
				trait = stressed
				trait = depressed
				trait = hedonist
				trait = monk
				trait = nun
				is_pregnant = yes
				trait = sympathy_islam
				trait = sympathy_pagans
				trait = sympathy_zoroastrianism
				trait = sympathy_judaism
				trait = sympathy_indian
				any_liege = { holy_order = yes }
				any_liege = { mercenary = yes }
				any_spouse = {
					trait = pregnant
					father_of_unborn = { character = ROOT }
				}
				any_heir_title = { always = yes }
				any_pretender_title = { always = yes }
				AND = {
					is_councillor = yes
					NOT = { has_job_title = job_spiritual }
				}
				has_minor_title = title_lord
				has_minor_title = title_commander
				religion = cathar
				religion = bogomilist
				religion = miaphysite
				religion = monophysite
				has_character_modifier = voice_of_satan
				has_character_modifier = planning_claimant_adventure
				has_character_flag = claimant_adventurer
				has_character_flag = monk_refused
			}
		}
		allow = {
			in_command = no
			is_ill = no
			calc_true_if = {
				amount = 2
				trait = zealous
				trait = humble
				trait = content
				trait = possessed
				trait = scholar
				trait = theologian
				trait = scholarly_theologian
				trait = mastermind_theologian
				has_character_modifier = voice_of_jesus
				has_job_title = job_spiritual
			}
			#won't go if married unless zealous/lunatic/possessed or he hates his wife
			OR = {
				is_married = no
				trait = zealous
				trait = lunatic
				trait = possessed
				NOT = { 
					any_spouse = { reverse_opinion = { who = ROOT value = 0 } }
				}
			}
			#won't go if he has a legit child unless lunatic/possessed
			OR = {
				NOT = {
					any_child = {
						is_alive = yes
						is_adult = no
						NOT = { trait = bastard }
					}
				}
				trait = lunatic
				trait = possessed
			}
			liege = {
				religion = ROOT
				war = no
			}
		}
		effect = {
			if = {
				limit = {
					liege = {
						OR = {
							ai = yes
							NOR = {
								dynasty = ROOT
								is_close_relative = ROOT
							}
						}
					}
				}
				any_spouse = { remove_spouse = ROOT }
				if = {
					limit = { is_female = no }
					change_learning = 1
					add_trait = monk
					set_character_flag = title_monk
					set_special_character_title = MONK_BROTHER
				}
				if = {
					limit = { is_female = yes }
					change_learning = 1
					add_trait = nun
					set_character_flag = title_nun
					set_special_character_title = NUN_SISTER
				}
			}
			if = {
				limit = {
					liege = {
						ai = no
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
						}
					}
				}
				liege = {
					letter_event = { id = Plus.2062 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes
			}
			modifier = {
				factor = 0.1
				NOT = { age = 20 }
			}
			modifier = {
				factor = 0.25
				NOT = { age = 25 }
			}
			modifier = {
				factor = 0.5
				NOT = { age = 30 }
			}
			modifier = {
				factor = 5
				OR = {
					liege = { is_theocracy = yes }
					has_job_title = job_spiritual
				}
			}
			modifier = {
				factor = 0.5
				NOR = {
					trait = detached_priest
					trait = martial_cleric
					trait = scholarly_theologian
					trait = mastermind_theologian
				}
			}
			modifier = {
				factor = 10
				has_character_modifier = voice_of_jesus
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 0.25
				trait = proud
			}
			modifier = {
				factor = 0.25
				trait = slothful
			}
			modifier = {
				factor = 0.25
				OR = {
					father_even_if_dead = { higher_tier_than = COUNT }
					mother_even_if_dead = { higher_tier_than = COUNT }
				}
			}
		}
	}

	ai_gain_title_pope = {
		is_high_prio = yes
		potential = {
			ai = yes
			is_playable = yes
			controls_religion = no
			religion_group = christian
			OR = {
				has_landed_title = d_pentarch_rome
				has_landed_title = d_pentarch_alexandria
			}
			NOT = { has_character_flag = has_title_pope }
			NOT = { has_character_flag = has_title_ecumenical }
		}
		allow = {
			always = yes
		}
		effect = {
			set_special_character_title = POPE
			set_character_flag = has_title_pope
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	ai_lose_title_pope = {
		is_high_prio = yes
		potential = {
			ai = yes
			has_character_flag = has_title_pope
		}
		allow = {
			NAND = {
				is_playable = yes
				controls_religion = no
				religion_group = christian
				OR = {
					has_landed_title = d_pentarch_rome
					has_landed_title = d_pentarch_alexandria
				}
			}
		}
		effect = {
			remove_special_character_title = POPE
			clr_character_flag = has_title_pope
		}
		ai_will_do = {
			factor = 1
		}
	}

	ai_gain_title_ecumenical = {
		is_high_prio = yes
		potential = {
			ai = yes
			is_playable = yes
			controls_religion = no
			religion = chalcedonian
			has_landed_title = d_pentarch_constantinople
			NOT = { has_character_flag = has_title_ecumenical }
			NOT = { has_character_flag = has_title_pope }
		}
		allow = {
			always = yes
		}
		effect = {
			set_special_character_title = ECUMENICAL_PATRIARCH
			set_character_flag = has_title_ecumenical
		}
		ai_will_do = {
			factor = 1
		}
	}
	
	ai_lose_title_ecumenical = {
		is_high_prio = yes
		potential = {
			ai = yes
			has_character_flag = has_title_ecumenical
		}
		allow = {
			NAND = {
				is_playable = yes
				controls_religion = no
				religion = chalcedonian
				has_landed_title = d_pentarch_constantinople
			}
		}
		effect = {
			remove_special_character_title = ECUMENICAL_PATRIARCH
			clr_character_flag = has_title_ecumenical
		}
		ai_will_do = {
			factor = 1
		}
	}

	ai_abandon_NAP = {
		potential = {
			ai = yes
			is_adult = yes
			prisoner = no
			any_non_aggression_pact_character = {
				OR = {
					AND = {
						is_liege_of = ROOT
						NOT = { reverse_opinion = { who = ROOT value = 0 } }
					}
					AND = {
						any_demesne_title = {
							claimed_by = ROOT
							is_usable_claim_trigger = yes
						}
						OR = {
							NOT = { reverse_opinion = { who = ROOT value = 25 } }
							AND = {
								NOT = { reverse_opinion = { who = ROOT value = 50 } }
								ROOT = {
									OR = {
										trait = deceitful
										trait = ambitious
										trait = envious
										trait = proud
										trait = brave
									}
								}
							}
						}
					}
				}
				NOR = {
					is_allied_with = ROOT
					is_married = ROOT
					any_close_relative = { is_married = ROOT }
					ROOT = { any_heir_title = { holder = PREVPREV } }
					reverse_has_opinion_modifier = { who = ROOT modifier = hostile_family }
					reverse_has_opinion_modifier = { who = ROOT modifier = in_non_aggression_pact }
				}
			}
		}
		allow = {
			NOR = {
				trait = content
				trait = craven
				trait = incapable
				trait = imbecile
				trait = nun
				trait = monk
				trait = in_hiding
				any_liege = { holy_order = yes }
				any_liege = { mercenary = yes }
			}
		}
		effect = {
			random_non_aggression_pact_character = {
				limit = {
					OR = {
						AND = {
							is_liege_of = ROOT
							NOT = { reverse_opinion = { who = ROOT value = 0 } }
						}
						AND = {
							any_demesne_title = {
								claimed_by = ROOT
								is_usable_claim_trigger = yes
							}
							OR = {
								NOT = { reverse_opinion = { who = ROOT value = 25 } }
								AND = {
									NOT = { reverse_opinion = { who = ROOT value = 50 } }
									ROOT = {
										OR = {
											trait = deceitful
											trait = ambitious
											trait = envious
											trait = proud
											trait = brave
										}
									}
								}
							}
						}
					}
					NOR = {
						is_allied_with = ROOT
						is_married = ROOT
						any_close_relative = { is_married = ROOT }
						ROOT = { any_heir_title = { holder = PREVPREV } }
						reverse_has_opinion_modifier = { who = ROOT modifier = hostile_family }
						reverse_has_opinion_modifier = { who = ROOT modifier = in_non_aggression_pact }
					}
				}
				reverse_opinion = { who = ROOT modifier = hostile_family years = 1 }
			}
		}
		ai_will_do = {
			factor = 1
		}
	}
}

title_decisions = {
	
	ai_institute_gavelkind = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				is_feudal = yes
				is_tribal = yes
			}
			OR = {
				is_tribal = no
				NOT = { religion_group = pagan_group }
			}
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			NOT = { religion = celtic_pagan }
			NOT = { religion_group = muslim }
			is_merchant_republic = no
			is_patrician = no
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
			in_revolt = no
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			NOT = { has_law = succ_gavelkind }
			rebel = no			
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				NOT = { has_law = succ_elective_gavelkind }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_feudal_elective }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_tanistry }
				is_titular = yes
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Gavelkind"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			tooltip = { succession = gavelkind }
			hidden_tooltip = {
				#set flag so we know what the former law was
				pf_save_old_succ_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }
				
				#actually change the law
				add_law = succ_gavelkind

				holder_scope = {
					#current heir is unhappy (they have to share) if they were the previous heir
					event_target:changed_title = {
						current_heir = {
							if = { 
								limit = { has_character_flag = former_heir }
								opinion = {
									who = PREVPREV
									modifier = opinion_succ_law_change
									months = 240
								}
							}
						}
					}
					#legitimate children are happy
					any_child = {
						limit = {
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								has_character_flag = former_heir
								has_character_flag = former_pretender
								any_heir_title = { title = event_target:changed_title }
								any_pretender_title = { title = event_target:changed_title }
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_good_succ_law_change
							months = 240
						}
					}
					#vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_gavelkind
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_gavelkind }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# title was gavelkind previously
					AND = {
						is_primary_holder_title = yes
						has_title_flag = former_gavelkind
						OR = {
							has_law = succ_ultimogeniture
							# now primogeniture but ruler has more than one possible heir
							AND = {
								has_law = succ_primogeniture
								holder_scope = {
									any_child = {
										NOR = {
											trait = bastard
											trait = disinherited
											trait = slow
											trait = imbecile
											trait = inbred
											trait = incapable
											trait = lunatic
										}
										OR = {
											AND = {
												ROOT = {
													NOR = {
														has_law = cognatic_succession
														has_law = agnatic_succession
													}
												}
												is_female = yes
											}
											AND = {
												ROOT = {
													NOR = {
														has_law = enatic_cognatic_succession
														has_law = enatic_succession
													}
												}
												is_female = no
											}
										}
										dynasty = PREV
										count = 2
									}
								}
							}
							# now seniority but ruler has at least one child who could be heir
							AND = {
								has_law = succ_seniority
								holder_scope = {
									NOR = {
										culture_group = east_slavic
										culture_group = west_slavic
										culture_group = south_slavic
										culture = hungarian
										culture = ethiopian
									}
									primary_title = {
										current_heir = {
											NOT = { is_child_of = PREVPREV }
										}
									}
									any_child = {
										NOR = {
											trait = bastard
											trait = disinherited
											trait = slow
											trait = imbecile
											trait = inbred
											trait = incapable
											trait = lunatic
										}
										OR = {
											AND = {
												ROOT = {
													NOR = {
														has_law = cognatic_succession
														has_law = agnatic_succession
													}
												}
												is_female = yes
											}
											AND = {
												ROOT = {
													NOR = {
														has_law = enatic_cognatic_succession
														has_law = enatic_succession
													}
												}
												is_female = no
											}
										}
										dynasty = PREV
									}
								}
							}
						}
					}
					# is tribal after 900
					AND = {
						is_primary_holder_title = yes
						holder_scope = { is_tribal = yes }
						year = 900
					}
					# primary title is gavelkind
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_gavelkind } }
					}
					# has multiple possible heirs and is kind or charitable
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
								reverse_opinion = { who = PREV value = 25 }
								is_adult = yes
								count = 2
							}
							OR = {
								trait = kind
								trait = charitable
								trait = just
							}
							NOR = {
								trait = ambitious
								trait = proud
								trait = cruel
							}
						}
					}
				}
			}
		}
	}

	ai_institute_seniority = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			NOT = { religion_group = muslim }
			NOT = { religion_group = indian_group }
			NOT = { religion = celtic_pagan }
			OR = {
				is_republic = no
				is_patrician = yes
			}
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				is_tribal = no
				has_global_flag = ancient_religions
			}
		}
		potential = {
			holder_scope = {
				OR = {
					is_merchant_republic = no
					primary_title = {
						NOT = { title = ROOT }
					}
				}
			}
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			NOT = { has_law = succ_seniority }
			OR = {
				AND = {
					tier = baron
					is_feudal = yes
				}
				holder_scope = { is_feudal = yes }
				holder_scope = { is_patrician = yes }
			}
			OR = {
				NOT = { tier = baron }
				holder_scope = { is_patrician = yes }
			}
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				NOT = { has_law = succ_elective_gavelkind }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_feudal_elective }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_tanistry }
				is_titular = yes
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
			holder_scope = {
				primary_title = {
					OR = {
						has_law = late_feudal_administration
						has_law = imperial_administration
					}
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Seniority"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			tooltip = { succession = seniority }
			hidden_tooltip = {
				#set flag so we know what the former law was
				pf_save_old_succ_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = succ_seniority

				holder_scope = {
					#legitimate children are angry
					any_child = {
						limit = {
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								any_heir_title = { title = event_target:changed_title }
								any_pretender_title = { title = event_target:changed_title }
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_bad_succ_law_change
							months = 240
						}
					}
					#dynasty members are pleased
					any_dynasty_member = {
						limit = {
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_good_succ_law_change
							months = 240
						}
					}
					#vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_seniority
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_seniority }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# title was seniority previously
					AND = {
						is_primary_holder_title = yes
						has_title_flag = former_seniority
						# have a decent dynasty relative I like
						holder_scope = {
							any_dynasty_member = {
								dynasty = PREV
								is_older_than = PREV
								is_close_relative = PREV
								reverse_opinion = { who = PREV value = 25 }
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
									is_child_of = PREV
									father_even_if_dead = { is_child_of = PREVPREV }
									mother_even_if_dead = { is_child_of = PREVPREV }
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
							}
						}
						OR = {
							has_law = succ_ultimogeniture
							# now gavelkind and I don't have multiple children
							AND = {
								has_law = succ_gavelkind
								holder_scope = {
									NOT = {
										any_child = {
											NOR = {
												trait = bastard
												trait = disinherited
												trait = slow
												trait = imbecile
												trait = inbred
												trait = incapable
												trait = lunatic
											}
											OR = {
												AND = {
													ROOT = {
														NOR = {
															has_law = cognatic_succession
															has_law = agnatic_succession
														}
													}
													is_female = yes
												}
												AND = {
													ROOT = {
														NOR = {
															has_law = enatic_cognatic_succession
															has_law = enatic_succession
														}
													}
													is_female = no
												}
											}
											dynasty = PREV
											count = 2
										}
									}
								}
							}
							# now primogeniture and my heir is either unsuitable or not my child
							AND = {
								has_law = succ_primogeniture
								current_heir = {
									OR = {
										trait = slow
										trait = imbecile
										trait = inbred
										trait = incapable
										trait = lunatic
										NOR = {
											is_child_of = FROM
											father_even_if_dead = { is_child_of = FROM }
											mother_even_if_dead = { is_child_of = FROM }
										}
									}
								}
							}
						}
					}
					# primary title is seniority
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_seniority } }
					}
					# older ruler has no children but has a liked close relative and the heir is neither liked nor a close relative
					AND = {
						is_primary_holder_title = no
						current_heir = {
							NOR = {
								is_close_relative = FROM
								reverse_opinion = { who = FROM value = 25 }
							}
						}
						holder_scope = {
							age = 40
							any_dynasty_member = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								reverse_opinion = { who = FROM value = 25 }
								is_adult = yes
								is_close_relative = PREV
							}
							NOT = {
								any_child = {
									NOR = {
										trait = bastard
										trait = disinherited
										trait = imbecile
										trait = inbred
										trait = incapable
										trait = lunatic
									}
									OR = {
										AND = {
											ROOT = {
												NOR = {
													has_law = cognatic_succession
													has_law = agnatic_succession
												}
											}
											is_female = yes
										}
										AND = {
											ROOT = {
												NOR = {
													has_law = enatic_cognatic_succession
													has_law = enatic_succession
												}
											}
											is_female = no
										}
									}
									dynasty = PREV
								}
							}
						}
					}
					# is slavic and under gavelkind
					AND = {
						is_primary_holder_title = yes
						has_law = succ_gavelkind
						holder_scope = {
							OR = {
								culture_group = east_slavic
								culture_group = west_slavic
								culture_group = south_slavic
								culture = hungarian
								culture = ethiopian
							}
							NOR = {
								trait = content
								trait = charitable
								trait = kind
								trait = slothful
								trait = imbecile
								trait = slow
								trait = inbred
							}
						}
					}
				}
			}
		}
	}

	ai_institute_primogeniture = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			NOT = { religion_group = muslim }
			NOT = { religion = celtic_pagan }
			is_merchant_republic = no
			is_patrician = no
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			NOT = { has_law = succ_primogeniture }
			OR = {
				holder_scope = { # Viceroyalties can always have primogeniture if not muslim
					any_demesne_title = {
						is_vice_royalty = yes
					}
				}
				AND = {
					holder_scope = {
						OR = {
							independent = yes
							NOT = { any_liege = { holy_order = yes } }
						}
						OR = {
							NOT = { religion_group = pagan_group }
							is_reformed_religion = yes
							is_tribal = no
							has_global_flag = ancient_religions
						}
					}
					is_primary_type_title = no
					OR = {
						AND = {
							tier = baron
							is_feudal = yes
						}
						holder_scope = { is_feudal = yes }
					}
				}
			}
			OR = {
				NOT = { has_law = succ_elective_gavelkind }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_feudal_elective }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_tanistry }
				is_titular = yes
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
			holder_scope = {
				primary_title = {
					OR = {
						has_law = late_feudal_administration
						has_law = imperial_administration
					}
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Primogeniture"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			tooltip = { succession = primogeniture }
			hidden_tooltip = {
				#set flag so we know what the former law was
				pf_save_old_succ_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }
				
				#actually change the law
				add_law = succ_primogeniture

				holder_scope = {
					#current heir is pleased
					event_target:changed_title = {
						current_heir = {
							opinion = {
								who = PREVPREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#legitimate children are upset
					any_child = {
						limit = {
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								has_character_flag = former_heir
								has_character_flag = former_pretender
								any_heir_title = { title = event_target:changed_title }
								any_pretender_title = { title = event_target:changed_title }
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_bad_succ_law_change
							months = 240
						}
					}
					#vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_primogeniture
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_primogeniture }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# primary title has primogeniture
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_primogeniture } }
					}
					# has an eligible heir over 6 years old and is proud/ambitious ( or the title was primogeniture previously )
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
								age = 6
							}
							OR = {
								trait = proud
								trait = ambitious
								ROOT = { has_title_flag = former_primogeniture }
							}
						}
					}
					# has an exceptional heir and is not content or humble
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								calc_true_if = {
									count = 3
									diplomacy = 21
									martial = 21
									diplomacy = 15
									martial = 15
									diplomacy = 8
									martial = 8
									stewardship = 8
									trait = genius
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
								NOT = {
									any_sibling = {
										NOT = { trait = bastard }
										is_older_than = PREV
										OR = {
											AND = {
												ROOT = {
													NOR = {
														has_law = cognatic_succession
														has_law = agnatic_succession
													}
												}
												is_female = yes
											}
											AND = {
												ROOT = {
													NOR = {
														has_law = enatic_cognatic_succession
														has_law = enatic_succession
													}
												}
												is_female = no
											}
										}
									}
								}
							}
							NOR = {
								trait = content
								trait = humble
							}
						}
					}
					# has an eligible heir and doesn't like current heir, and is not content/humble/craven
					AND = {
						is_primary_holder_title = yes
						current_heir = {
							NOR = {
								dynasty = FROM
								is_close_relative = FROM
								reverse_opinion = { who = FROM value = 0 }
							}
						}
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
								age = 6
							}
							NOR = {
								trait = content
								trait = humble
								trait = craven
							}
						}
					}
				}
			}
		}
	}
	
	ai_institute_feudal_elective = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			NOT = { culture_group = celtic }
			NOT = { culture = scottish }
			NOT = { religion_group = muslim }
			NOT = { religion_group = indian_group }
			NOT = { religion = celtic_pagan }
			is_merchant_republic = no
			is_patrician = no
			is_feudal = yes
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				is_tribal = no
				has_global_flag = ancient_religions
			}
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			NOT = { has_law = succ_feudal_elective }
			is_primary_type_title = no
			is_vice_royalty = no
			NOT = { tier = baron }
			OR = {
				NOT = { has_law = succ_elective_gavelkind }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_tanistry }
				is_titular = yes
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
			holder_scope = {
				primary_title = {
					OR = {
						has_law = late_feudal_administration
						has_law = imperial_administration
					}
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Feudal Elective"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			tooltip = { succession = feudal_elective }
			hidden_tooltip = {
				#set flag so we know what the former law was
				pf_save_old_succ_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = succ_feudal_elective

				any_de_jure_vassal = {
					limit = {
						OR = {
							AND = {
								tier = baron
								ROOT = { tier = count }
							}
							AND = {
								tier = count
								ROOT = { tier = duke }
							}
							higher_tier_than = count
						}
					}
					set_character_flag = dejure_vassal
				}
				holder_scope = {
					#all legitimate children are upset
					any_child = {
						limit = {
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_bad_succ_law_change
							months = 240
						}
					}
					#dynasty members are somewhat upset
					any_dynasty_member = {
						limit = {
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
					#electors are pleased
					any_vassal = {
						limit = {
							has_character_flag = dejure_vassal
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_good_succ_law_change
							months = 240
						}
					}
					#other vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
				}
				any_de_jure_vassal = {
					clr_character_flag = dejure_vassal
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_feudal_elective
			}
			modifier = {
				factor = 0
				OR = {
					is_primary_holder_title = no
					lower_real_tier_than = KING
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# is Hellenic
					holder_scope = { religion = hellenic_pagan }
					# has a lot of vassals, is way over the vassal limit, and not a strong ruler
					holder_scope = {
						num_of_vassals = 15
						over_vassal_limit = 5
						OR = {
							trait = trusting
							trait = humble
							trait = charitable
							trait = slow
							trait = imbecile
							trait = infirm
						}
						NOR = {
							trait = ambitious
							trait = proud
							trait = lunatic
							diplomacy = 12
							martial = 12
							stewardship = 12
							intrigue = 12
						}
					}
					# is culture appropriate with at least three dukes and over the vassal limit
					holder_scope = {
						OR = {
							culture_group = north_germanic
							culture_group = central_germanic
							culture_group = west_germanic
							culture = frankish
							culture = norman
							culture = roman
							culture = nubian
							culture = somali
						}
						any_vassal = {
							higher_real_tier_than = COUNT
							count = 3
						}
						over_vassal_limit = 3
					}
					# has no close relative heirs and has at least three vassals he likes
					holder_scope = {
						ROOT = { current_heir = { NOT = { is_close_relative = PREVPREV } } }
						age = 40
						OR = {
							trait = charitable
							trait = just
							trait = gregarious
							trait = imbecile
							trait = slow
						}
						NOR = {
							trait = ambitious
							trait = proud
						}
						any_vassal = {
							is_feudal = yes
							is_adult = yes
							primary_title = { de_jure_liege_or_above = ROOT }
							NOT = { any_heir_title = { title = ROOT } }
							reverse_opinion = { who = PREV value = 25 }
							count = 3
						}
					}
				}
			}
		}
	}

	ai_institute_tanistry = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				culture_group = celtic
				culture = scottish
				religion = celtic_pagan
			}
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				is_tribal = no
				religion = celtic_pagan
				has_global_flag = ancient_religions
			}
			NOT = { religion_group = muslim }
			is_feudal = yes
			is_merchant_republic = no
			is_patrician = no
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			NOT = { has_law = succ_tanistry }
			OR = {
				NOT = { tier = baron }
				holder_scope = { religion = celtic_pagan }
			}
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				NOT = { has_law = succ_feudal_elective }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_elective_gavelkind }
				is_titular = yes
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Tanistry"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			tooltip = { succession = tanistry }
			hidden_tooltip = {
				#set flag so we know what the former law was
				pf_save_old_succ_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = succ_tanistry

				any_de_jure_vassal = {
					limit = {
						OR = {
							AND = {
								tier = baron
								ROOT = { tier = count }
							}
							AND = {
								tier = count
								ROOT = { tier = duke }
							}
							higher_tier_than = count
						}
					}
					set_character_flag = dejure_vassal
				}
				holder_scope = {
					#all legitimate children are upset
					any_child = {
						limit = {
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_bad_succ_law_change
							months = 240
						}
					}
					#dynasty members are somewhat upset
					any_dynasty_member = {
						limit = {
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
					#electors are pleased
					any_vassal = {
						limit = {
							has_character_flag = dejure_vassal
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_good_succ_law_change
							months = 240
						}
					}
					#other vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
				}
				any_de_jure_vassal = {
					clr_character_flag = dejure_vassal
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_tanistry
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_tanistry }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# is celtic pagan
					AND = {
						is_primary_holder_title = yes
						holder_scope = { religion = celtic_pagan }
					}
					# was formerly tanistry and current heir is not of the ruler's dynasty
					AND = {
						is_primary_holder_title = yes
						has_title_flag = former_tanistry
						current_heir = { NOT = { dynasty = FROM } }
						holder_scope = {
							any_dynasty_member = {
								is_adult = yes
								same_realm = PREV
								NOT = { character = PREV }
							}
						}
					}
					# primary title has gavelkind and is proud or ambitious
					AND = {
						is_primary_holder_title = yes
						has_law = succ_gavelkind
						holder_scope = {
							OR = {
								trait = proud
								trait = ambitious
							}
						}
					}
					# primary title has tanistry
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_tanistry } }
					}
					# has no child or brother as heir and is charitable or just
					AND = {
						is_primary_holder_title = yes
						current_heir = {
							NOR = {
								is_child_of = FROM
								sibling = FROM
							}
						}
						holder_scope = {
							age = 30
							OR = {
								trait = charitable
								trait = just
							}
						}
					}
				}
			}
		}
	}

	ai_institute_ultimogeniture = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				is_tribal = no
				culture = mongol
				has_global_flag = ancient_religions
			}
			NOT = { religion_group = muslim }
			NOT = { religion = celtic_pagan }
			is_merchant_republic = no
			is_patrician = no
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			NOT = { has_law = succ_ultimogeniture }
			OR = {
				AND = {
					tier = baron
					is_feudal = yes
				}
				holder_scope = { is_feudal = yes }
			}
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				NOT = { has_law = succ_elective_gavelkind }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_feudal_elective }
				is_titular = yes
			}
			OR = {
				NOT = { has_law = succ_tanistry }
				is_titular = yes
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Ultimogeniture"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			tooltip = { succession = ultimogeniture }
			hidden_tooltip = {
				#set flag so we know what the former law was
				pf_save_old_succ_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = succ_ultimogeniture

				holder_scope = {
					#current heir is pleased
					event_target:changed_title = {
						current_heir = {
							opinion = {
								who = PREVPREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#other legitimate children are upset
					any_child = {
						limit = {
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								has_character_flag = former_heir
								has_character_flag = former_pretender
								any_heir_title = { title = event_target:changed_title }
								any_pretender_title = { title = event_target:changed_title }
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_bad_succ_law_change
							months = 240
						}
					}
					#dynasty members are slightly upset
					any_dynasty_member = {
						limit = {
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
					#vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_ultimogeniture
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_ultimogeniture }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# primary title has tanistry
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_tanistry } }
					}
					# ruler is non-nomadic mongol
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							culture = mongol
							NOT = { has_landed_title = e_mongol_empire }
						}
					}
				}
			}
		}
	}
	
	ai_institute_elective_to_gavelkind = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				is_feudal = yes
				is_tribal = yes
			}
			OR = {
				is_tribal = no
				NOT = { religion_group = pagan_group }
			}
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			NOT = { religion = celtic_pagan }
			NOT = { religion_group = muslim }
			is_merchant_republic = no
			is_patrician = no
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
			in_revolt = no
			NOT = { has_character_flag = voting_on_succession_law }
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			rebel = no		
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				has_law = succ_elective_gavelkind
				has_law = succ_feudal_elective
				has_law = succ_tanistry
			}
			is_titular = no
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] is holding a vote to change the succession law of the [Root.GetFullName] to Gavelkind"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP7 }
			hidden_tooltip = {
				set_title_flag = title_to_change
				holder_scope = {
					set_character_flag = voting_on_succession_law
					set_character_flag = vote_is_for_gavelkind
					set_variable = { which = "succession_law_vote" value = 1 }
					character_event = { id = Plus.600 days = 1 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_gavelkind
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_gavelkind }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# title was gavelkind previously, now feudal elective/tanistry but ruler has at least one child who could be heir
					AND = {
						is_primary_holder_title = yes
						has_title_flag = former_gavelkind
						OR = {
							has_law = succ_feudal_elective
							has_law = succ_tanistry
						}
						holder_scope = {
							primary_title = {
								current_heir = {
									NOT = { is_child_of = PREVPREV }
								}
							}
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
							}
						}
					}
					# is tribal
					AND = {
						is_primary_holder_title = yes
						holder_scope = { is_tribal = yes }
					}
					# primary title is elective gavelkind
					AND = {
						is_primary_holder_title = yes
						has_law = succ_elective_gavelkind
					}
					# primary title is gavelkind
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_gavelkind } }
					}
					# has multiple possible adult heirs and is kind or charitable
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = { has_law = true_cognatic_succession }
										is_female = yes
									}
									is_female = no
								}
								reverse_opinion = { who = PREV value = 25 }
								is_adult = yes
								count = 2
							}
							OR = {
								trait = kind
								trait = charitable
								trait = just
							}
							NOR = {
								trait = ambitious
								trait = proud
								trait = cruel
							}
						}
					}
				}
			}
		}
	}
	
	ai_institute_elective_to_seniority = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			NOT = { religion_group = muslim }
			NOT = { religion_group = indian_group }
			NOT = { religion = celtic_pagan }
			OR = {
				is_republic = no
				is_patrician = yes
			}
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				is_tribal = no
				has_global_flag = ancient_religions
			}
			NOT = { has_character_flag = voting_on_succession_law }
		}
		potential = {
			holder_scope = {
				OR = {
					is_merchant_republic = no
					primary_title = {
						NOT = { title = ROOT }
					}
				}
			}
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			OR = {
				AND = {
					tier = baron
					is_feudal = yes
				}
				holder_scope = { is_feudal = yes }
				holder_scope = { is_patrician = yes }
			}
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				NOT = { tier = baron }
				holder_scope = { is_patrician = yes }
				holder_scope = { religion = hellenic_pagan }
			}
			OR = {
				has_law = succ_elective_gavelkind
				has_law = succ_feudal_elective
				has_law = succ_tanistry
			}
			is_titular = no
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
			holder_scope = {
				primary_title = {
					OR = {
						has_law = late_feudal_administration
						has_law = imperial_administration
					}
				}
			}
		}
		effect = {
			log = "[From.GetBestName] is holding a vote to change the succession law of the [Root.GetFullName] to Seniority"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP7 }
			hidden_tooltip = {
				set_title_flag = title_to_change
				holder_scope = {
					set_character_flag = voting_on_succession_law
					set_character_flag = vote_is_for_seniority
					set_variable = { which = "succession_law_vote" value = 1 }
					character_event = { id = Plus.600 days = 1 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_seniority
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_seniority }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# title was seniority previously
					AND = {
						is_primary_holder_title = yes
						has_title_flag = former_seniority
						# have a decent dynasty relative I like
						holder_scope = {
							any_dynasty_member = {
								dynasty = PREV
								is_older_than = PREV
								is_close_relative = PREV
								reverse_opinion = { who = PREV value = 25 }
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
									is_child_of = PREV
									father_even_if_dead = { is_child_of = PREVPREV }
									mother_even_if_dead = { is_child_of = PREVPREV }
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
							}
						}
						OR = {
							# is now feudal elective and heir is neither the ruler's dynasty or a close relative
							AND = {
								has_law = succ_feudal_elective
								current_heir = {
									NOR = {
										is_close_relative = FROM
										dynasty = FROM
									}
								}
							}
							# is now tanistry and heir is not a close relative
							AND = {
								has_law = succ_tanistry
								current_heir = { NOT = { is_close_relative = FROM } }
							}
						}
					}
					# primary title is seniority
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_seniority } }
					}
					# older ruler has no children but has a liked close relative and heir is neither liked nor a close relative
					AND = {
						is_primary_holder_title = no
						current_heir = {
							NOR = {
								is_close_relative = FROM
								reverse_opinion = { who = FROM value = 25 }
							}
						}
						holder_scope = {
							age = 40
							any_dynasty_member = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								reverse_opinion = { who = FROM value = 25 }
								is_adult = yes
								is_close_relative = PREV
							}
							NOT = {
								any_child = {
									NOR = {
										trait = bastard
										trait = disinherited
										trait = imbecile
										trait = inbred
										trait = incapable
										trait = lunatic
									}
									OR = {
										AND = {
											ROOT = {
												NOR = {
													has_law = cognatic_succession
													has_law = agnatic_succession
												}
											}
											is_female = yes
										}
										AND = {
											ROOT = {
												NOR = {
													has_law = enatic_cognatic_succession
													has_law = enatic_succession
												}
											}
											is_female = no
										}
									}
									dynasty = PREV
								}
							}
						}
					}
					# slavic ruler who is ambitious or proud
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							OR = {
								culture_group = east_slavic
								culture_group = west_slavic
								culture_group = south_slavic
								culture = hungarian
							}
							OR = {
								trait = ambitious
								trait = proud
								ROOT = { has_law = succ_elective_gavelkind }
							}
							NOR = {
								trait = content
								trait = charitable
								trait = kind
								trait = slothful
								trait = imbecile
								trait = slow
								trait = inbred
							}
						}
					}
				}
			}
		}
	}
	
	ai_institute_elective_to_primogeniture = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			NOT = { religion_group = muslim }
			NOT = { religion = celtic_pagan }
			is_merchant_republic = no
			is_patrician = no
			NOT = { has_character_flag = voting_on_succession_law }
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			OR = {
				holder_scope = { # Viceroyalties can always have primogeniture if not muslim
					any_demesne_title = {
						is_vice_royalty = yes
					}
				}
				AND = {
					holder_scope = {
						OR = {
							independent = yes
							NOT = { any_liege = { holy_order = yes } }
						}
						OR = {
							NOT = { religion_group = pagan_group }
							is_reformed_religion = yes
							is_tribal = no
							has_global_flag = ancient_religions
						}
					}
					is_primary_type_title = no
					OR = {
						AND = {
							tier = baron
							is_feudal = yes
						}
						holder_scope = { is_feudal = yes }
					}
				}
			}
			OR = {
				has_law = succ_elective_gavelkind
				has_law = succ_feudal_elective
				has_law = succ_tanistry
			}
			is_titular = no
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
			holder_scope = {
				primary_title = {
					OR = {
						has_law = late_feudal_administration
						has_law = imperial_administration
					}
				}
			}
		}
		effect = {
			log = "[From.GetBestName] is holding a vote to change the succession law of the [Root.GetFullName] to Primogeniture"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP7 }
			hidden_tooltip = {
				set_title_flag = title_to_change
				holder_scope = {
					set_character_flag = voting_on_succession_law
					set_character_flag = vote_is_for_primogeniture
					set_variable = { which = "succession_law_vote" value = 1 }
					character_event = { id = Plus.600 days = 1 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_primogeniture
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_primogeniture }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# primary title has primogeniture
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_primogeniture } }
					}
					# has an eligible heir over 6 years old and is proud/ambitious ( or the title was primogeniture previously )
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
								age = 6
							}
							OR = {
								trait = proud
								trait = ambitious
								ROOT = { has_title_flag = former_primogeniture }
							}
						}
					}
					# has an exceptional heir and is not content or humble
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								calc_true_if = {
									count = 3
									diplomacy = 21
									martial = 21
									diplomacy = 15
									martial = 15
									diplomacy = 8
									martial = 8
									stewardship = 8
									trait = genius
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
								NOT = {
									any_sibling = {
										NOT = { trait = bastard }
										is_older_than = PREV
										OR = {
											AND = {
												ROOT = {
													NOR = {
														has_law = cognatic_succession
														has_law = agnatic_succession
													}
												}
												is_female = yes
											}
											AND = {
												ROOT = {
													NOR = {
														has_law = enatic_cognatic_succession
														has_law = enatic_succession
													}
												}
												is_female = no
											}
										}
									}
								}
							}
							NOR = {
								trait = content
								trait = humble
							}
						}
					}
					# has an eligible heir and doesn't like current heir, and is not content/humble/craven
					AND = {
						is_primary_holder_title = yes
						current_heir = {
							NOR = {
								dynasty = FROM
								is_close_relative = FROM
								reverse_opinion = { who = FROM value = 0 }
							}
						}
						holder_scope = {
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								OR = {
									AND = {
										ROOT = {
											NOR = {
												has_law = cognatic_succession
												has_law = agnatic_succession
											}
										}
										is_female = yes
									}
									AND = {
										ROOT = {
											NOR = {
												has_law = enatic_cognatic_succession
												has_law = enatic_succession
											}
										}
										is_female = no
									}
								}
								dynasty = PREV
								age = 6
							}
							NOR = {
								trait = content
								trait = humble
								trait = craven
							}
						}
					}
				}
			}
		}
	}	
	
	ai_institute_elective_to_tanistry = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				culture_group = celtic
				culture = scottish
				religion = celtic_pagan
			}
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				is_tribal = no
				religion = celtic_pagan
				has_global_flag = ancient_religions
			}
			NOT = { religion_group = muslim }
			NOT = { religion = celtic_pagan }
			is_merchant_republic = no
			is_patrician = no
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
			NOT = { has_character_flag = voting_on_succession_law }
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			OR = {
				NOT = { tier = baron }
				holder_scope = { religion = celtic_pagan }
			}
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				has_law = succ_elective_gavelkind
				has_law = succ_feudal_elective
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] is holding a vote to change the succession law of the [Root.GetFullName] to Tanistry"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP7 }
			hidden_tooltip = {
				set_title_flag = title_to_change
				holder_scope = {
					set_character_flag = voting_on_succession_law
					set_character_flag = vote_is_for_tanistry
					set_variable = { which = "succession_law_vote" value = 1 }
					character_event = { id = Plus.600 days = 1 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_tanistry
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = succ_tanistry }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# is celtic pagan
					AND = {
						is_primary_holder_title = yes
						holder_scope = { religion = celtic_pagan }
					}
					# was formerly tanistry and current heir is not of the ruler's dynasty
					AND = {
						is_primary_holder_title = yes
						has_title_flag = former_tanistry
						current_heir = { NOT = { dynasty = FROM } }
						holder_scope = {
							any_dynasty_member = {
								is_adult = yes
								same_realm = PREV
								NOT = { character = PREV }
							}
						}
					}
					# primary title has gavelkind and is proud or ambitious
					AND = {
						is_primary_holder_title = yes
						has_law = succ_gavelkind
						holder_scope = {
							OR = {
								trait = proud
								trait = ambitious
							}
						}
					}
					# primary title has tanistry
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = succ_tanistry } }
					}
					# has no child or brother as heir and is charitable or just
					AND = {
						is_primary_holder_title = yes
						current_heir = {
							NOR = {
								is_child_of = FROM
								sibling = FROM
							}
						}
						holder_scope = {
							age = 30
							OR = {
								trait = charitable
								trait = just
							}
						}
					}
				}
			}
		}
	}

	ai_institute_elective_to_feudal_elective = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				independent = yes
				NOT = { any_liege = { holy_order = yes } }
			}
			NOT = { culture_group = celtic }
			NOT = { culture = scottish }
			NOT = { religion_group = muslim }
			NOT = { religion_group = indian_group }
			NOT = { religion = celtic_pagan }
			is_merchant_republic = no
			is_patrician = no
			is_feudal = yes
			OR = {
				NOT = { religion_group = pagan_group }
				is_reformed_religion = yes
				is_tribal = no
				has_global_flag = ancient_religions
			}
			OR = {
				independent = yes
				NOT = { any_demesne_title = { is_vice_royalty = yes } }
			}
			NOT = { has_character_flag = voting_on_succession_law }
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			is_primary_type_title = no
			is_vice_royalty = no
			NOT = { tier = baron }
			OR = {
				has_law = succ_elective_gavelkind
				has_law = succ_tanistry
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
			holder_scope = {
				primary_title = {
					OR = {
						has_law = late_feudal_administration
						has_law = imperial_administration
					}
				}
			}
		}
		effect = {
			log = "[From.GetBestName] is holding a vote to change the succession law of the [Root.GetFullName] to Feudal Elective"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP7 }
			hidden_tooltip = {
				set_title_flag = title_to_change
				holder_scope = {
					set_character_flag = voting_on_succession_law
					set_character_flag = vote_is_for_feudal_elective
					set_variable = { which = "succession_law_vote" value = 1 }
					character_event = { id = Plus.600 days = 1 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_feudal_elective
			}
			modifier = {
				factor = 0
				OR = {
					is_primary_holder_title = no
					lower_real_tier_than = KING
				}
			}
			modifier = {
				factor = 0
				NOR = {
					holder_scope = { religion = hellenic_pagan }
					# has a lot of vassals, is way over the vassal limit, and not a strong ruler
					holder_scope = {
						num_of_vassals = 15
						over_vassal_limit = 5
						OR = {
							trait = trusting
							trait = humble
							trait = charitable
							trait = slow
							trait = imbecile
							trait = infirm
						}
						NOR = {
							trait = ambitious
							trait = proud
							trait = lunatic
							diplomacy = 12
							martial = 12
							stewardship = 12
							intrigue = 12
						}
					}
					# is culture appropriate with at least three dukes and over the vassal limit
					holder_scope = {
						OR = {
							culture_group = north_germanic
							culture_group = central_germanic
							culture_group = west_germanic
							culture = frankish
							culture = norman
							culture = roman
							culture = nubian
							culture = somali
						}
						any_vassal = {
							higher_real_tier_than = COUNT
							count = 3
						}
						over_vassal_limit = 3
					}
					# has no close relative heirs and has at least three vassals he likes
					holder_scope = {
						ROOT = { current_heir = { NOT = { is_close_relative = PREVPREV } } }
						age = 40
						OR = {
							trait = charitable
							trait = just
							trait = gregarious
							trait = imbecile
							trait = slow
						}
						NOR = {
							trait = ambitious
							trait = proud
						}
						any_vassal = {
							is_feudal = yes
							is_adult = yes
							primary_title = { de_jure_liege_or_above = ROOT }
							NOT = { any_heir_title = { title = ROOT } }
							reverse_opinion = { who = PREV value = 25 }
							count = 3
						}
					}
				}
			}
		}
	}

	ai_institute_cognatic_succession = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			OR = {
				independent = yes
				NOT = {
					any_liege = { holy_order = yes }
				}
				is_merchant_republic = yes
			}
			NOT = { religion_group = muslim }
			NOT = { religion = aztec }
			is_merchant_republic = no
			is_patrician = no
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			is_vice_royalty = no
			OR = {
				AND = {
					tier = baron
					is_theocracy = no
					is_republic = no
				}
				holder_scope = {
					is_theocracy = no
					is_republic = no
				}
			}
			is_primary_type_title = no
			OR = {
				has_law = agnatic_succession
				has_law = true_cognatic_succession
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Cognatic"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP12 }
			hidden_tooltip = {
				if = {
					limit = { has_law = true_cognatic_succession }
					holder_scope = { set_character_flag = coming_from_true_cognatic }
				}
				if = {
					limit = { has_law = agnatic_succession }
					holder_scope = { set_character_flag = coming_from_agnatic }
				}
				
				#set flag so we know what the former law was
				pf_save_old_gender_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = cognatic_succession

				holder_scope = {
					#legitimate male children are upset if changing from agnatic
					if = {
						limit = { has_character_flag = coming_from_agnatic }
						any_child = {
							limit = {
								is_female = no
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_bad_succ_law_change
								months = 240
							}
						}
					}
					#legitimate male children are pleased if changing from true cognatic
					if = {
						limit = { has_character_flag = coming_from_true_cognatic }
						any_child = {
							limit = {
								is_female = no
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#legitimate female children are pleased if changing from agnatic
					if = {
						limit = { has_character_flag = coming_from_agnatic }
						any_child = {
							limit = {
								is_female = yes
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#legitimate female children are upset if changing from true cognatic
					if = {
						limit = { has_character_flag = coming_from_true_cognatic }
						any_child = {
							limit = {
								is_female = yes
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_bad_succ_law_change
								months = 240
							}
						}
					}
					#male vassals are more upset if changing from agnatic
					if = {
						limit = { has_character_flag = changing_from_agnatic }
						any_vassal = {
							limit = {
								is_female = no
								OR = {
									primary_title = { de_jure_liege_or_above = event_target:changed_title }
									event_target:changed_title = { is_primary_holder_title = yes }
									event_target:changed_title = { is_titular = yes }
								}
								NOR = {
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_succ_law_change
								multiplier = 2
								months = 240
							}
						}
					}
					#female vassals are more upset if changing from true cognatic
					if = {
						limit = { has_character_flag = changing_from_true_cognatic }
						any_vassal = {
							limit = {
								is_female = yes
								OR = {
									primary_title = { de_jure_liege_or_above = event_target:changed_title }
									event_target:changed_title = { is_primary_holder_title = yes }
									event_target:changed_title = { is_titular = yes }
								}
								NOR = {
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_succ_law_change
								multiplier = 2
								months = 240
							}
						}
					}
					#other vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
					clr_character_flag = coming_from_agnatic
					clr_character_flag = coming_from_true_cognatic
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_cognatic_succession
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOR = {
								has_law = cognatic_succession
								has_law = true_cognatic_succession
								has_law = enatic_cognatic_succession
								has_law = enatic_succession
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# primary title is cognatic
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = cognatic_succession } }
					}
					# a female ruler under agnatic
					AND = {
						is_primary_holder_title = yes
						has_law = agnatic_succession
						holder_scope = {
							is_female = yes
							NOR = {
								trait = humble
								trait = content
								trait = zealous
							}
						}
					}
					# a very religious older male ruler under true cognatic with a son
					AND = {
						is_primary_holder_title = yes
						has_law = true_cognatic_succession
						holder_scope = {
							is_female = no
							age = 50
							trait = zealous
							NOR = {
								is_feminist_trigger = yes
								culture = basque
							}
							is_heretic = no
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								dynasty = PREV
								is_female = no
								age = 6
							}
						}
					}
					# a male ruler under true cognatic with an adult son and a female heir
					AND = {
						is_primary_holder_title = yes
						has_law = true_cognatic_succession
						OR = {
							has_law = succ_gavelkind
							has_law = succ_primogeniture
						}
						current_heir = { is_female = yes }
						holder_scope = {
							is_female = no
							NOR = {
								is_feminist_trigger = yes
								trait = just
								trait = content
							}
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								dynasty = PREV
								is_female = no
								is_adult = yes
							}
						}
					}
					# a ruler under agnatic with an adult daughter who could inherit and no child/grandchild who is heir
					AND = {
						is_primary_holder_title = yes
						has_law = agnatic_succession
						OR = {
							has_law = succ_gavelkind
							has_law = succ_primogeniture
						}
						current_heir = {
							NOR = {
								is_child_of = FROM
								father_even_if_dead = { is_child_of = FROM }
								mother_even_if_dead = { is_child_of = FROM }
							}
						}
						holder_scope = {
							any_child = {
								is_female = yes
								is_adult = yes
								dynasty = PREV
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
							}
						}
					}
					# a ruler under agnatic with an adult diplomatic daughter whom he loves
					AND = {
						is_primary_holder_title = yes
						has_law = agnatic_succession
						holder_scope = {
							any_child = {
								is_female = yes
								is_adult = yes
								dynasty = PREV
								reverse_opinion = { who = PREV value = 50 }
								diplomacy = 12
							}
							OR = {
								trait = charitable
								trait = kind
								trait = just
							}
							NOR = {
								trait = humble
								trait = craven
								trait = slothful
							}
						}
					}
					# ruler under agnatic who is feminist or basque
					AND = {
						is_primary_holder_title = yes
						has_law = agnatic_succession
						holder_scope = {
							OR = {
								is_feminist_trigger = yes
								culture = basque
							}
						}
					}
				}
			}
		}
	}
	
	ai_institute_agnatic_succession = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			is_vice_royalty = no
			has_law = cognatic_succession
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Agnatic"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP11 }
			hidden_tooltip = {
				#set flag so we know what the former law was
				pf_save_old_gender_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = agnatic_succession

				holder_scope = {
					#legitimate male children are pleased
					any_child = {
						limit = {
							is_female = no
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								has_character_flag = former_heir
								has_character_flag = former_pretender
								any_heir_title = { title = event_target:changed_title }
								any_pretender_title = { title = event_target:changed_title }
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_good_succ_law_change
							months = 240
						}
					}
					#legitimate female children are upset
					any_child = {
						limit = {
							is_female = yes
							NOR = {
								trait = bastard
								trait = monk
								trait = nun
								trait = disinherited
								has_character_flag = former_heir
								has_character_flag = former_pretender
								any_heir_title = { title = event_target:changed_title }
								any_pretender_title = { title = event_target:changed_title }
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_bad_succ_law_change
							months = 240
						}
					}
					#dynasty members angry/happy according to gender
					any_dynasty_member = {
						limit = {
							is_female = no
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_good_succ_law_change
							months = 240
						}
					}
					any_dynasty_member = {
						limit = {
							is_female = yes
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_bad_succ_law_change
							months = 240
						}
					}
					#vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_agnatic_succession
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = agnatic_succession }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# is zealous and title was formerly agnatic and current heir is not female
					AND = {
						is_primary_holder_title = yes
						has_title_flag = former_agnatic_succession
						current_heir = { is_female = no }
						holder_scope = { trait = zealous }
					}
					# holder is muslim
					AND = {
						is_primary_holder_title = yes
						holder_scope = { religion_group = muslim }
					}
					# primary title is agnatic
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = agnatic_succession } }
					}
					# a very religious older male ruler under cognatic with a son
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							is_female = no
							age = 50
							trait = zealous
							NOR = {
								is_feminist_trigger = yes
								culture = basque
							}
							is_heretic = no
							any_child = {
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								dynasty = PREV
								is_female = no
								age = 6
							}
						}
					}
				}
			}
		}
	}
	
	ai_institute_true_cognatic_succession = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			NOT = { religion_group = muslim }
			NOT = { religion = aztec }
			is_merchant_republic = no
			is_patrician = no
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			is_vice_royalty = no
			OR = {
				AND = {
					tier = baron
					is_theocracy = no
					is_republic = no
				}
				holder_scope = {
					is_theocracy = no
					is_republic = no
				}
			}
			is_primary_type_title = no
			OR = {
				has_law = cognatic_succession
				has_law = enatic_cognatic_succession
			}
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to True Cognatic"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP13 }
			hidden_tooltip = {
				if = {
					limit = { has_law = cognatic_succession }
					holder_scope = { set_character_flag = coming_from_cognatic }
				}
				if = {
					limit = { has_law = enatic_cognatic_succession }
					holder_scope = { set_character_flag = coming_from_enatic_cognatic }
				}
				
				#set flag so we know what the former law was
				pf_save_old_gender_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = true_cognatic_succession

				holder_scope = {
					#legitimate male children are upset if changing from cognatic
					if = {
						limit = { has_character_flag = coming_from_cognatic }
						any_child = {
							limit = {
								is_female = no
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_bad_succ_law_change
								months = 240
							}
						}
					}
					#legitimate male children are pleased if changing from enatic-cognatic
					if = {
						limit = { has_character_flag = coming_from_true_enatic_cognatic }
						any_child = {
							limit = {
								is_female = no
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#legitimate female children are pleased if changing from cognatic
					if = {
						limit = { has_character_flag = coming_from_cognatic }
						any_child = {
							limit = {
								is_female = yes
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#legitimate female children are upset if changing from enatic-cognatic
					if = {
						limit = { has_character_flag = coming_from_enatic_cognatic }
						any_child = {
							limit = {
								is_female = yes
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_bad_succ_law_change
								months = 240
							}
						}
					}
					#male vassals are more upset if changing from cognatic
					if = {
						limit = { has_character_flag = changing_from_cognatic }
						any_vassal = {
							limit = {
								is_female = no
								OR = {
									primary_title = { de_jure_liege_or_above = event_target:changed_title }
									event_target:changed_title = { is_primary_holder_title = yes }
									event_target:changed_title = { is_titular = yes }
								}
								NOR = {
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_succ_law_change
								multiplier = 2
								months = 240
							}
						}
					}
					#female vassals are more upset if changing from enatic-cognatic
					if = {
						limit = { has_character_flag = changing_from_enatic_cognatic }
						any_vassal = {
							limit = {
								is_female = yes
								OR = {
									primary_title = { de_jure_liege_or_above = event_target:changed_title }
									event_target:changed_title = { is_primary_holder_title = yes }
									event_target:changed_title = { is_titular = yes }
								}
								NOR = {
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_succ_law_change
								multiplier = 2
								months = 240
							}
						}
					}
					#other vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
					clr_character_flag = coming_from_cognatic
					clr_character_flag = coming_from_enatic_cognatic
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 20
				has_title_flag = former_true_cognatic_succession
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOR = {
								has_law = true_cognatic_succession
								has_law = enatic_cognatic_succession
								has_law = enatic_succession
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# is zealous and enatic-cognatic title was formerly true cognatic
					AND = {
						is_primary_holder_title = yes
						has_law = enatic_cognatic_succession
						holder_scope = { trait = zealous }
						has_title_flag = former_true_cognatic_succession
					}
					# primary title is true cognatic
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = true_cognatic_succession } }
					}
					# a female ruler under cognatic who is just
					AND = {
						is_primary_holder_title = yes
						has_law = cognatic_succession
						holder_scope = {
							is_female = yes
							OR = {
								trait = just
								trait = proud
								trait = charitable
								diplomacy = 15
							}
							NOR = {
								trait = humble
								trait = content
								trait = arbitrary
							}
						}
					}
					# has an awesome older daughter who could be heir instead
					AND = {
						is_primary_holder_title = yes
						has_law = cognatic_succession
						OR = {
							has_law = succ_gavelkind
							has_law = succ_primogeniture
						}
						holder_scope = {
							any_child = {
								is_female = yes
								dynasty = PREV
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								calc_true_if = {
									count = 3
									diplomacy = 21
									martial = 21
									diplomacy = 15
									martial = 15
									diplomacy = 8
									martial = 8
									stewardship = 8
									trait = genius
								}
								any_sibling = {
									is_female = no
									NOT = { is_older_than = PREV }
									any_heir_title = { title = ROOT }
									OR = {
										trait = bastard
										trait = disinherited
										trait = slow
										trait = imbecile
										trait = inbred
										trait = incapable
										trait = lunatic
										NOR = { 
											diplomacy = 12
											martial = 12
											trait = genius
											trait = quick
										}
									}
								}
							}
						}
					}
					# a male ruler under enatic-cognatic with a son
					AND = {
						is_primary_holder_title = yes
						has_law = enatic_cognatic_succession
						holder_scope = {
							is_female = no
							is_feminist_trigger = no
							any_child = {
								is_female = no
								age = 6
								dynasty = PREV
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
							}
						}
					}
					# a basque ruler under cognatic with an adult daughter
					AND = {
						is_primary_holder_title = yes
						has_law = cognatic_succession
						holder_scope = {
							culture = basque
							OR = {
								is_female = yes
								any_child = {
									NOR = {
										trait = bastard
										trait = disinherited
										trait = slow
										trait = imbecile
										trait = inbred
										trait = incapable
										trait = lunatic
									}
									dynasty = PREV
									is_female = yes
									is_adult = yes
								}
							}
						}
					}
					# ruler under cognatic who is feminist
					AND = {
						is_primary_holder_title = yes
						has_law = cognatic_succession
						holder_scope = { is_feminist_trigger = yes }
					}				
					# ruler is learned and believes in equality
					AND = {
						is_primary_holder_title = yes
						holder_scope = {
							trait = just
							OR = {
								trait = scholar
								learning = 12
							}
							NOR = {
								trait = zealous
								trait = content
								trait = humble
								trait = slothful
							}
						}
					}
				}
			}
		}
	}

	ai_institute_enatic_cognatic_succession = {
		filter = owned
		ai_target_filter = owned
		
		from_potential = {
			ai = yes
			NOT = { religion_group = muslim }
			NOT = { religion = aztec }
			is_merchant_republic = no
			is_patrician = no
		}
		potential = {
			OR = {
				higher_tier_than = DUKE
				is_primary_holder_title = yes
			}
			OR = {
				AND = {
					tier = baron
					is_feudal = yes
				}
				holder_scope = { is_feudal = yes }
			}
			is_primary_type_title = no
			is_vice_royalty = no
			OR = {
				has_law = true_cognatic_succession
				has_law = enatic_succession
			}
			NOT = { has_law = enatic_cognatic_succession }
			e_placeholder = { has_title_flag = startup }
		}
		allow = {
			can_change_succession_law = yes
			OR = {
				AND = {
					tier = BARON
					holder_scope = { prestige = 125 }
				}
				AND = {
					tier = COUNT
					holder_scope = { prestige = 250 }
				}
				AND = {
					tier = DUKE
					holder_scope = { prestige = 500 }
				}
				AND = {
					tier = KING
					holder_scope = { prestige = 750 }
				}
				AND = {
					tier = EMPEROR
					holder_scope = { prestige = 1000 }
				}
			}
		}
		effect = {
			log = "[From.GetBestName] has changed the succession law of the [Root.GetFullName] to Enatic-Cognatic"
			holder_scope = { set_character_flag = changed_succession_@ROOT }
			if = {
				limit = { tier = BARON }
				holder_scope = { prestige = -125 }
			}
			if = {
				limit = { tier = COUNT }
				holder_scope = { prestige = -250 }
			}
			if = {
				limit = { tier = DUKE }
				holder_scope = { prestige = -500 }
			}
			if = {
				limit = { tier = KING }
				holder_scope = { prestige = -750 }
			}
			if = {
				limit = { tier = EMPEROR }
				holder_scope = { prestige = -1000 }
			}
			holder_scope = {
				if = {
					limit = { any_vassal = { leads_faction = faction_tradition } }
					custom_tooltip = { text = TRADITIONFACTIONMOODMINUS }
					hidden_tooltip = {
						random_vassal = { limit = { leads_faction = faction_tradition } set_variable = { which = "faction_mood_decrease" value = 2 } }
						character_event = { id = PlusFaction.200 days = 1 } #recalculate faction moods
					}
				}
			}
			custom_tooltip = { text = CUSTOMTOOLTIP14 }
			hidden_tooltip = {
				if = {
					limit = { has_law = true_cognatic_succession }
					holder_scope = { set_character_flag = coming_from_true_cognatic }
				}
				if = {
					limit = { has_law = enatic_succession }
					holder_scope = { set_character_flag = coming_from_enatic }
				}
				
				#set flag so we know what the former law was
				pf_save_old_gender_law_effect = yes
				
				set_title_flag = title_to_change
				save_event_target_as = changed_title
				
				#set opinion changes for heirs and pretenders
				current_heir = { set_character_flag = former_heir }
				any_character = {
					limit = { any_pretender_title = { title = event_target:changed_title } }
					set_character_flag = former_pretender
				}
				holder_scope = { character_event = { id = Plus.604 days = 1 } }

				#actually change the law
				add_law = enatic_cognatic_succession

				holder_scope = {
					#legitimate female children are upset if changing from enatic
					if = {
						limit = { has_character_flag = coming_from_enatic }
						any_child = {
							limit = {
								is_female = yes
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_bad_succ_law_change
								months = 240
							}
						}
					}
					#legitimate female children are pleased if changing from true cognatic
					if = {
						limit = { has_character_flag = coming_from_true_cognatic }
						any_child = {
							limit = {
								is_female = yes
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#legitimate male children are pleased if changing from enatic
					if = {
						limit = { has_character_flag = coming_from_enatic }
						any_child = {
							limit = {
								is_female = no
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_good_succ_law_change
								months = 240
							}
						}
					}
					#legitimate male children are upset if changing from true cognatic
					if = {
						limit = { has_character_flag = coming_from_true_cognatic }
						any_child = {
							limit = {
								is_female = no
								NOR = {
									trait = bastard
									trait = monk
									trait = nun
									trait = disinherited
									has_character_flag = former_heir
									has_character_flag = former_pretender
									any_heir_title = { title = event_target:changed_title }
									any_pretender_title = { title = event_target:changed_title }
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change 	}
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_bad_succ_law_change
								months = 240
							}
						}
					}
					#female vassals are more upset if changing from enatic
					if = {
						limit = { has_character_flag = changing_from_enatic }
						any_vassal = {
							limit = {
								is_female = yes
								OR = {
									primary_title = { de_jure_liege_or_above = event_target:changed_title }
									event_target:changed_title = { is_primary_holder_title = yes }
									event_target:changed_title = { is_titular = yes }
								}
								NOR = {
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_succ_law_change
								multiplier = 2
								months = 240
							}
						}
					}
					#male vassals are more upset if changing from true cognatic
					if = {
						limit = { has_character_flag = changing_from_true_cognatic }
						any_vassal = {
							limit = {
								is_female = no
								OR = {
									primary_title = { de_jure_liege_or_above = event_target:changed_title }
									event_target:changed_title = { is_primary_holder_title = yes }
									event_target:changed_title = { is_titular = yes }
								}
								NOR = {
									has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
									has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
								}
							}
							opinion = {
								who = PREV
								modifier = opinion_succ_law_change
								multiplier = 2
								months = 240
							}
						}
					}
					#other vassals are slightly upset
					any_vassal = {
						limit = {
							OR = {
								primary_title = { de_jure_liege_or_above = event_target:changed_title }
								event_target:changed_title = { is_primary_holder_title = yes }
								event_target:changed_title = { is_titular = yes }
							}
							NOR = {
								has_opinion_modifier = { who = PREV modifier = opinion_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_good_succ_law_change }
								has_opinion_modifier = { who = PREV modifier = opinion_bad_succ_law_change }
							}
						}
						opinion = {
							who = PREV
							modifier = opinion_succ_law_change
							months = 240
						}
					}
					clr_character_flag = coming_from_enatic
					clr_character_flag = coming_from_true_cognatic
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 0
				is_primary_holder_title = yes
				holder_scope = {
					lower_real_tier_than = DUKE
					independent = no
					primary_title = {
						dejure_liege_title = {
							NOT = { has_law = enatic_cognatic_succession }
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					# primary title is enatic cognatic
					AND = {
						is_primary_holder_title = no
						holder_scope = { primary_title = { has_law = enatic_cognatic_succession } }
					}
					# a female ruler with an awesome daughter who could be heir instead
					AND = {
						is_primary_holder_title = yes
						has_law = true_cognatic_succession
						OR = {
							has_law = succ_gavelkind
							has_law = succ_primogeniture
						}
						holder_scope = {
							is_female = yes
							any_child = {
								is_female = yes
								dynasty = PREV
								NOR = {
									trait = bastard
									trait = disinherited
									trait = slow
									trait = imbecile
									trait = inbred
									trait = incapable
									trait = lunatic
								}
								calc_true_if = {
									count = 3
									diplomacy = 21
									martial = 21
									diplomacy = 15
									martial = 15
									diplomacy = 8
									martial = 8
									stewardship = 8
									trait = genius
								}
								any_sibling = {
									is_female = no
									is_older_than = PREV
									any_heir_title = { title = ROOT }
									OR = {
										trait = bastard
										trait = disinherited
										trait = slow
										trait = imbecile
										trait = inbred
										trait = incapable
										trait = lunatic
										NOR = { 
											diplomacy = 12
											martial = 12
											trait = genius
											trait = quick
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

